{"ast":null,"code":"var conventions = require(\"./conventions\");\n\nvar NAMESPACE = conventions.NAMESPACE;\n/**\r\n * A prerequisite for `[].filter`, to drop elements that are empty\r\n * @param {string} input\r\n * @returns {boolean}\r\n */\n\nfunction notEmptyString(input) {\n  return input !== '';\n}\n/**\r\n * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace\r\n * @see https://infra.spec.whatwg.org/#ascii-whitespace\r\n *\r\n * @param {string} input\r\n * @returns {string[]} (can be empty)\r\n */\n\n\nfunction splitOnASCIIWhitespace(input) {\n  // U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE\n  return input ? input.split(/[\\t\\n\\f\\r ]+/).filter(notEmptyString) : [];\n}\n/**\r\n * Adds element as a key to current if it is not already present.\r\n *\r\n * @param {Record<string, boolean | undefined>} current\r\n * @param {string} element\r\n * @returns {Record<string, boolean | undefined>}\r\n */\n\n\nfunction orderedSetReducer(current, element) {\n  if (!current.hasOwnProperty(element)) {\n    current[element] = true;\n  }\n\n  return current;\n}\n/**\r\n * @see https://infra.spec.whatwg.org/#ordered-set\r\n * @param {string} input\r\n * @returns {string[]}\r\n */\n\n\nfunction toOrderedSet(input) {\n  if (!input) return [];\n  var list = splitOnASCIIWhitespace(input);\n  return Object.keys(list.reduce(orderedSetReducer, {}));\n}\n/**\r\n * Uses `list.indexOf` to implement something like `Array.prototype.includes`,\r\n * which we can not rely on being available.\r\n *\r\n * @param {any[]} list\r\n * @returns {function(any): boolean}\r\n */\n\n\nfunction arrayIncludes(list) {\n  return function (element) {\n    return list && list.indexOf(element) !== -1;\n  };\n}\n\nfunction copy(src, dest) {\n  for (var p in src) {\n    dest[p] = src[p];\n  }\n}\n/**\r\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\r\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\r\n */\n\n\nfunction _extends(Class, Super) {\n  var pt = Class.prototype;\n\n  if (!(pt instanceof Super)) {\n    function t() {}\n\n    ;\n    t.prototype = Super.prototype;\n    t = new t();\n    copy(pt, t);\n    Class.prototype = pt = t;\n  }\n\n  if (pt.constructor != Class) {\n    if (typeof Class != 'function') {\n      console.error(\"unknown Class:\" + Class);\n    }\n\n    pt.constructor = Class;\n  }\n} // Node Types\n\n\nvar NodeType = {};\nvar ELEMENT_NODE = NodeType.ELEMENT_NODE = 1;\nvar ATTRIBUTE_NODE = NodeType.ATTRIBUTE_NODE = 2;\nvar TEXT_NODE = NodeType.TEXT_NODE = 3;\nvar CDATA_SECTION_NODE = NodeType.CDATA_SECTION_NODE = 4;\nvar ENTITY_REFERENCE_NODE = NodeType.ENTITY_REFERENCE_NODE = 5;\nvar ENTITY_NODE = NodeType.ENTITY_NODE = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE = NodeType.COMMENT_NODE = 8;\nvar DOCUMENT_NODE = NodeType.DOCUMENT_NODE = 9;\nvar DOCUMENT_TYPE_NODE = NodeType.DOCUMENT_TYPE_NODE = 10;\nvar DOCUMENT_FRAGMENT_NODE = NodeType.DOCUMENT_FRAGMENT_NODE = 11;\nvar NOTATION_NODE = NodeType.NOTATION_NODE = 12; // ExceptionCode\n\nvar ExceptionCode = {};\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR = ExceptionCode.INDEX_SIZE_ERR = (ExceptionMessage[1] = \"Index size error\", 1);\nvar DOMSTRING_SIZE_ERR = ExceptionCode.DOMSTRING_SIZE_ERR = (ExceptionMessage[2] = \"DOMString size error\", 2);\nvar HIERARCHY_REQUEST_ERR = ExceptionCode.HIERARCHY_REQUEST_ERR = (ExceptionMessage[3] = \"Hierarchy request error\", 3);\nvar WRONG_DOCUMENT_ERR = ExceptionCode.WRONG_DOCUMENT_ERR = (ExceptionMessage[4] = \"Wrong document\", 4);\nvar INVALID_CHARACTER_ERR = ExceptionCode.INVALID_CHARACTER_ERR = (ExceptionMessage[5] = \"Invalid character\", 5);\nvar NO_DATA_ALLOWED_ERR = ExceptionCode.NO_DATA_ALLOWED_ERR = (ExceptionMessage[6] = \"No data allowed\", 6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = (ExceptionMessage[7] = \"No modification allowed\", 7);\nvar NOT_FOUND_ERR = ExceptionCode.NOT_FOUND_ERR = (ExceptionMessage[8] = \"Not found\", 8);\nvar NOT_SUPPORTED_ERR = ExceptionCode.NOT_SUPPORTED_ERR = (ExceptionMessage[9] = \"Not supported\", 9);\nvar INUSE_ATTRIBUTE_ERR = ExceptionCode.INUSE_ATTRIBUTE_ERR = (ExceptionMessage[10] = \"Attribute in use\", 10); //level2\n\nvar INVALID_STATE_ERR = ExceptionCode.INVALID_STATE_ERR = (ExceptionMessage[11] = \"Invalid state\", 11);\nvar SYNTAX_ERR = ExceptionCode.SYNTAX_ERR = (ExceptionMessage[12] = \"Syntax error\", 12);\nvar INVALID_MODIFICATION_ERR = ExceptionCode.INVALID_MODIFICATION_ERR = (ExceptionMessage[13] = \"Invalid modification\", 13);\nvar NAMESPACE_ERR = ExceptionCode.NAMESPACE_ERR = (ExceptionMessage[14] = \"Invalid namespace\", 14);\nvar INVALID_ACCESS_ERR = ExceptionCode.INVALID_ACCESS_ERR = (ExceptionMessage[15] = \"Invalid access\", 15);\n/**\r\n * DOM Level 2\r\n * Object DOMException\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\r\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\r\n */\n\nfunction DOMException(code, message) {\n  if (message instanceof Error) {\n    var error = message;\n  } else {\n    error = this;\n    Error.call(this, ExceptionMessage[code]);\n    this.message = ExceptionMessage[code];\n    if (Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n  }\n\n  error.code = code;\n  if (message) this.message = this.message + \": \" + message;\n  return error;\n}\n\n;\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode, DOMException);\n/**\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\r\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\r\n * The items in the NodeList are accessible via an integral index, starting from 0.\r\n */\n\nfunction NodeList() {}\n\n;\nNodeList.prototype = {\n  /**\r\n   * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\r\n   * @standard level1\r\n   */\n  length: 0,\n\n  /**\r\n   * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\r\n   * @standard level1\r\n   * @param index  unsigned long \r\n   *   Index into the collection.\r\n   * @return Node\r\n   * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \r\n   */\n  item: function (index) {\n    return this[index] || null;\n  },\n  toString: function (isHTML, nodeFilter) {\n    for (var buf = [], i = 0; i < this.length; i++) {\n      serializeToString(this[i], buf, isHTML, nodeFilter);\n    }\n\n    return buf.join('');\n  }\n};\n\nfunction LiveNodeList(node, refresh) {\n  this._node = node;\n  this._refresh = refresh;\n\n  _updateLiveList(this);\n}\n\nfunction _updateLiveList(list) {\n  var inc = list._node._inc || list._node.ownerDocument._inc;\n\n  if (list._inc != inc) {\n    var ls = list._refresh(list._node); //console.log(ls.length)\n\n\n    __set__(list, 'length', ls.length);\n\n    copy(ls, list);\n    list._inc = inc;\n  }\n}\n\nLiveNodeList.prototype.item = function (i) {\n  _updateLiveList(this);\n\n  return this[i];\n};\n\n_extends(LiveNodeList, NodeList);\n/**\r\n * Objects implementing the NamedNodeMap interface are used\r\n * to represent collections of nodes that can be accessed by name.\r\n * Note that NamedNodeMap does not inherit from NodeList;\r\n * NamedNodeMaps are not maintained in any particular order.\r\n * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,\r\n * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,\r\n * and does not imply that the DOM specifies an order to these Nodes.\r\n * NamedNodeMap objects in the DOM are live.\r\n * used for attributes or DocumentType entities \r\n */\n\n\nfunction NamedNodeMap() {}\n\n;\n\nfunction _findNodeIndex(list, node) {\n  var i = list.length;\n\n  while (i--) {\n    if (list[i] === node) {\n      return i;\n    }\n  }\n}\n\nfunction _addNamedNode(el, list, newAttr, oldAttr) {\n  if (oldAttr) {\n    list[_findNodeIndex(list, oldAttr)] = newAttr;\n  } else {\n    list[list.length++] = newAttr;\n  }\n\n  if (el) {\n    newAttr.ownerElement = el;\n    var doc = el.ownerDocument;\n\n    if (doc) {\n      oldAttr && _onRemoveAttribute(doc, el, oldAttr);\n\n      _onAddAttribute(doc, el, newAttr);\n    }\n  }\n}\n\nfunction _removeNamedNode(el, list, attr) {\n  //console.log('remove attr:'+attr)\n  var i = _findNodeIndex(list, attr);\n\n  if (i >= 0) {\n    var lastIndex = list.length - 1;\n\n    while (i < lastIndex) {\n      list[i] = list[++i];\n    }\n\n    list.length = lastIndex;\n\n    if (el) {\n      var doc = el.ownerDocument;\n\n      if (doc) {\n        _onRemoveAttribute(doc, el, attr);\n\n        attr.ownerElement = null;\n      }\n    }\n  } else {\n    throw DOMException(NOT_FOUND_ERR, new Error(el.tagName + '@' + attr));\n  }\n}\n\nNamedNodeMap.prototype = {\n  length: 0,\n  item: NodeList.prototype.item,\n  getNamedItem: function (key) {\n    //\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n    //\t\t\treturn null;\n    //\t\t}\n    //console.log()\n    var i = this.length;\n\n    while (i--) {\n      var attr = this[i]; //console.log(attr.nodeName,key)\n\n      if (attr.nodeName == key) {\n        return attr;\n      }\n    }\n  },\n  setNamedItem: function (attr) {\n    var el = attr.ownerElement;\n\n    if (el && el != this._ownerElement) {\n      throw new DOMException(INUSE_ATTRIBUTE_ERR);\n    }\n\n    var oldAttr = this.getNamedItem(attr.nodeName);\n\n    _addNamedNode(this._ownerElement, this, attr, oldAttr);\n\n    return oldAttr;\n  },\n\n  /* returns Node */\n  setNamedItemNS: function (attr) {\n    // raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n    var el = attr.ownerElement,\n        oldAttr;\n\n    if (el && el != this._ownerElement) {\n      throw new DOMException(INUSE_ATTRIBUTE_ERR);\n    }\n\n    oldAttr = this.getNamedItemNS(attr.namespaceURI, attr.localName);\n\n    _addNamedNode(this._ownerElement, this, attr, oldAttr);\n\n    return oldAttr;\n  },\n\n  /* returns Node */\n  removeNamedItem: function (key) {\n    var attr = this.getNamedItem(key);\n\n    _removeNamedNode(this._ownerElement, this, attr);\n\n    return attr;\n  },\n  // raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n  //for level2\n  removeNamedItemNS: function (namespaceURI, localName) {\n    var attr = this.getNamedItemNS(namespaceURI, localName);\n\n    _removeNamedNode(this._ownerElement, this, attr);\n\n    return attr;\n  },\n  getNamedItemNS: function (namespaceURI, localName) {\n    var i = this.length;\n\n    while (i--) {\n      var node = this[i];\n\n      if (node.localName == localName && node.namespaceURI == namespaceURI) {\n        return node;\n      }\n    }\n\n    return null;\n  }\n};\n/**\r\n * The DOMImplementation interface represents an object providing methods\r\n * which are not dependent on any particular document.\r\n * Such an object is returned by the `Document.implementation` property.\r\n *\r\n * __The individual methods describe the differences compared to the specs.__\r\n *\r\n * @constructor\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN\r\n * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)\r\n * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core\r\n * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core\r\n * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard\r\n */\n\nfunction DOMImplementation() {}\n\nDOMImplementation.prototype = {\n  /**\r\n   * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.\r\n   * The different implementations fairly diverged in what kind of features were reported.\r\n   * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.\r\n   *\r\n   * @deprecated It is deprecated and modern browsers return true in all cases.\r\n   *\r\n   * @param {string} feature\r\n   * @param {string} [version]\r\n   * @returns {boolean} always true\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN\r\n   * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core\r\n   * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard\r\n   */\n  hasFeature: function (feature, version) {\n    return true;\n  },\n\n  /**\r\n   * Creates an XML Document object of the specified type with its document element.\r\n   *\r\n   * __It behaves slightly different from the description in the living standard__:\r\n   * - There is no interface/class `XMLDocument`, it returns a `Document` instance.\r\n   * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.\r\n   * - this implementation is not validating names or qualified names\r\n   *   (when parsing XML strings, the SAX parser takes care of that)\r\n   *\r\n   * @param {string|null} namespaceURI\r\n   * @param {string} qualifiedName\r\n   * @param {DocumentType=null} doctype\r\n   * @returns {Document}\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN\r\n   * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)\r\n   * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core\r\n   *\r\n   * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\r\n   * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\r\n   * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\r\n   */\n  createDocument: function (namespaceURI, qualifiedName, doctype) {\n    var doc = new Document();\n    doc.implementation = this;\n    doc.childNodes = new NodeList();\n    doc.doctype = doctype || null;\n\n    if (doctype) {\n      doc.appendChild(doctype);\n    }\n\n    if (qualifiedName) {\n      var root = doc.createElementNS(namespaceURI, qualifiedName);\n      doc.appendChild(root);\n    }\n\n    return doc;\n  },\n\n  /**\r\n   * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.\r\n   *\r\n   * __This behavior is slightly different from the in the specs__:\r\n   * - this implementation is not validating names or qualified names\r\n   *   (when parsing XML strings, the SAX parser takes care of that)\r\n   *\r\n   * @param {string} qualifiedName\r\n   * @param {string} [publicId]\r\n   * @param {string} [systemId]\r\n   * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation\r\n   * \t\t\t\t  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN\r\n   * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core\r\n   * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard\r\n   *\r\n   * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\r\n   * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\r\n   * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\r\n   */\n  createDocumentType: function (qualifiedName, publicId, systemId) {\n    var node = new DocumentType();\n    node.name = qualifiedName;\n    node.nodeName = qualifiedName;\n    node.publicId = publicId || '';\n    node.systemId = systemId || '';\n    return node;\n  }\n};\n/**\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\r\n */\n\nfunction Node() {}\n\n;\nNode.prototype = {\n  firstChild: null,\n  lastChild: null,\n  previousSibling: null,\n  nextSibling: null,\n  attributes: null,\n  parentNode: null,\n  childNodes: null,\n  ownerDocument: null,\n  nodeValue: null,\n  namespaceURI: null,\n  prefix: null,\n  localName: null,\n  // Modified in DOM Level 2:\n  insertBefore: function (newChild, refChild) {\n    //raises \n    return _insertBefore(this, newChild, refChild);\n  },\n  replaceChild: function (newChild, oldChild) {\n    //raises \n    this.insertBefore(newChild, oldChild);\n\n    if (oldChild) {\n      this.removeChild(oldChild);\n    }\n  },\n  removeChild: function (oldChild) {\n    return _removeChild(this, oldChild);\n  },\n  appendChild: function (newChild) {\n    return this.insertBefore(newChild, null);\n  },\n  hasChildNodes: function () {\n    return this.firstChild != null;\n  },\n  cloneNode: function (deep) {\n    return cloneNode(this.ownerDocument || this, this, deep);\n  },\n  // Modified in DOM Level 2:\n  normalize: function () {\n    var child = this.firstChild;\n\n    while (child) {\n      var next = child.nextSibling;\n\n      if (next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE) {\n        this.removeChild(next);\n        child.appendData(next.data);\n      } else {\n        child.normalize();\n        child = next;\n      }\n    }\n  },\n  // Introduced in DOM Level 2:\n  isSupported: function (feature, version) {\n    return this.ownerDocument.implementation.hasFeature(feature, version);\n  },\n  // Introduced in DOM Level 2:\n  hasAttributes: function () {\n    return this.attributes.length > 0;\n  },\n\n  /**\r\n   * Look up the prefix associated to the given namespace URI, starting from this node.\r\n   * **The default namespace declarations are ignored by this method.**\r\n   * See Namespace Prefix Lookup for details on the algorithm used by this method.\r\n   *\r\n   * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._\r\n   *\r\n   * @param {string | null} namespaceURI\r\n   * @returns {string | null}\r\n   * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix\r\n   * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo\r\n   * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix\r\n   * @see https://github.com/xmldom/xmldom/issues/322\r\n   */\n  lookupPrefix: function (namespaceURI) {\n    var el = this;\n\n    while (el) {\n      var map = el._nsMap; //console.dir(map)\n\n      if (map) {\n        for (var n in map) {\n          if (map[n] == namespaceURI) {\n            return n;\n          }\n        }\n      }\n\n      el = el.nodeType == ATTRIBUTE_NODE ? el.ownerDocument : el.parentNode;\n    }\n\n    return null;\n  },\n  // Introduced in DOM Level 3:\n  lookupNamespaceURI: function (prefix) {\n    var el = this;\n\n    while (el) {\n      var map = el._nsMap; //console.dir(map)\n\n      if (map) {\n        if (prefix in map) {\n          return map[prefix];\n        }\n      }\n\n      el = el.nodeType == ATTRIBUTE_NODE ? el.ownerDocument : el.parentNode;\n    }\n\n    return null;\n  },\n  // Introduced in DOM Level 3:\n  isDefaultNamespace: function (namespaceURI) {\n    var prefix = this.lookupPrefix(namespaceURI);\n    return prefix == null;\n  }\n};\n\nfunction _xmlEncoder(c) {\n  return c == '<' && '&lt;' || c == '>' && '&gt;' || c == '&' && '&amp;' || c == '\"' && '&quot;' || '&#' + c.charCodeAt() + ';';\n}\n\ncopy(NodeType, Node);\ncopy(NodeType, Node.prototype);\n/**\r\n * @param callback return true for continue,false for break\r\n * @return boolean true: break visit;\r\n */\n\nfunction _visitNode(node, callback) {\n  if (callback(node)) {\n    return true;\n  }\n\n  if (node = node.firstChild) {\n    do {\n      if (_visitNode(node, callback)) {\n        return true;\n      }\n    } while (node = node.nextSibling);\n  }\n}\n\nfunction Document() {}\n\nfunction _onAddAttribute(doc, el, newAttr) {\n  doc && doc._inc++;\n  var ns = newAttr.namespaceURI;\n\n  if (ns === NAMESPACE.XMLNS) {\n    //update namespace\n    el._nsMap[newAttr.prefix ? newAttr.localName : ''] = newAttr.value;\n  }\n}\n\nfunction _onRemoveAttribute(doc, el, newAttr, remove) {\n  doc && doc._inc++;\n  var ns = newAttr.namespaceURI;\n\n  if (ns === NAMESPACE.XMLNS) {\n    //update namespace\n    delete el._nsMap[newAttr.prefix ? newAttr.localName : ''];\n  }\n}\n\nfunction _onUpdateChild(doc, el, newChild) {\n  if (doc && doc._inc) {\n    doc._inc++; //update childNodes\n\n    var cs = el.childNodes;\n\n    if (newChild) {\n      cs[cs.length++] = newChild;\n    } else {\n      //console.log(1)\n      var child = el.firstChild;\n      var i = 0;\n\n      while (child) {\n        cs[i++] = child;\n        child = child.nextSibling;\n      }\n\n      cs.length = i;\n    }\n  }\n}\n/**\r\n * attributes;\r\n * children;\r\n * \r\n * writeable properties:\r\n * nodeValue,Attr:value,CharacterData:data\r\n * prefix\r\n */\n\n\nfunction _removeChild(parentNode, child) {\n  var previous = child.previousSibling;\n  var next = child.nextSibling;\n\n  if (previous) {\n    previous.nextSibling = next;\n  } else {\n    parentNode.firstChild = next;\n  }\n\n  if (next) {\n    next.previousSibling = previous;\n  } else {\n    parentNode.lastChild = previous;\n  }\n\n  _onUpdateChild(parentNode.ownerDocument, parentNode);\n\n  return child;\n}\n/**\r\n * preformance key(refChild == null)\r\n */\n\n\nfunction _insertBefore(parentNode, newChild, nextChild) {\n  var cp = newChild.parentNode;\n\n  if (cp) {\n    cp.removeChild(newChild); //remove and update\n  }\n\n  if (newChild.nodeType === DOCUMENT_FRAGMENT_NODE) {\n    var newFirst = newChild.firstChild;\n\n    if (newFirst == null) {\n      return newChild;\n    }\n\n    var newLast = newChild.lastChild;\n  } else {\n    newFirst = newLast = newChild;\n  }\n\n  var pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\n  newFirst.previousSibling = pre;\n  newLast.nextSibling = nextChild;\n\n  if (pre) {\n    pre.nextSibling = newFirst;\n  } else {\n    parentNode.firstChild = newFirst;\n  }\n\n  if (nextChild == null) {\n    parentNode.lastChild = newLast;\n  } else {\n    nextChild.previousSibling = newLast;\n  }\n\n  do {\n    newFirst.parentNode = parentNode;\n  } while (newFirst !== newLast && (newFirst = newFirst.nextSibling));\n\n  _onUpdateChild(parentNode.ownerDocument || parentNode, parentNode); //console.log(parentNode.lastChild.nextSibling == null)\n\n\n  if (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n    newChild.firstChild = newChild.lastChild = null;\n  }\n\n  return newChild;\n}\n\nfunction _appendSingleChild(parentNode, newChild) {\n  var cp = newChild.parentNode;\n\n  if (cp) {\n    var pre = parentNode.lastChild;\n    cp.removeChild(newChild); //remove and update\n\n    var pre = parentNode.lastChild;\n  }\n\n  var pre = parentNode.lastChild;\n  newChild.parentNode = parentNode;\n  newChild.previousSibling = pre;\n  newChild.nextSibling = null;\n\n  if (pre) {\n    pre.nextSibling = newChild;\n  } else {\n    parentNode.firstChild = newChild;\n  }\n\n  parentNode.lastChild = newChild;\n\n  _onUpdateChild(parentNode.ownerDocument, parentNode, newChild);\n\n  return newChild; //console.log(\"__aa\",parentNode.lastChild.nextSibling == null)\n}\n\nDocument.prototype = {\n  //implementation : null,\n  nodeName: '#document',\n  nodeType: DOCUMENT_NODE,\n\n  /**\r\n   * The DocumentType node of the document.\r\n   *\r\n   * @readonly\r\n   * @type DocumentType\r\n   */\n  doctype: null,\n  documentElement: null,\n  _inc: 1,\n  insertBefore: function (newChild, refChild) {\n    //raises\n    if (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n      var child = newChild.firstChild;\n\n      while (child) {\n        var next = child.nextSibling;\n        this.insertBefore(child, refChild);\n        child = next;\n      }\n\n      return newChild;\n    }\n\n    if (this.documentElement == null && newChild.nodeType == ELEMENT_NODE) {\n      this.documentElement = newChild;\n    }\n\n    return _insertBefore(this, newChild, refChild), newChild.ownerDocument = this, newChild;\n  },\n  removeChild: function (oldChild) {\n    if (this.documentElement == oldChild) {\n      this.documentElement = null;\n    }\n\n    return _removeChild(this, oldChild);\n  },\n  // Introduced in DOM Level 2:\n  importNode: function (importedNode, deep) {\n    return importNode(this, importedNode, deep);\n  },\n  // Introduced in DOM Level 2:\n  getElementById: function (id) {\n    var rtv = null;\n\n    _visitNode(this.documentElement, function (node) {\n      if (node.nodeType == ELEMENT_NODE) {\n        if (node.getAttribute('id') == id) {\n          rtv = node;\n          return true;\n        }\n      }\n    });\n\n    return rtv;\n  },\n\n  /**\r\n   * The `getElementsByClassName` method of `Document` interface returns an array-like object\r\n   * of all child elements which have **all** of the given class name(s).\r\n   *\r\n   * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.\r\n   *\r\n   *\r\n   * Warning: This is a live LiveNodeList.\r\n   * Changes in the DOM will reflect in the array as the changes occur.\r\n   * If an element selected by this array no longer qualifies for the selector,\r\n   * it will automatically be removed. Be aware of this for iteration purposes.\r\n   *\r\n   * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\r\n   * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname\r\n   */\n  getElementsByClassName: function (classNames) {\n    var classNamesSet = toOrderedSet(classNames);\n    return new LiveNodeList(this, function (base) {\n      var ls = [];\n\n      if (classNamesSet.length > 0) {\n        _visitNode(base.documentElement, function (node) {\n          if (node !== base && node.nodeType === ELEMENT_NODE) {\n            var nodeClassNames = node.getAttribute('class'); // can be null if the attribute does not exist\n\n            if (nodeClassNames) {\n              // before splitting and iterating just compare them for the most common case\n              var matches = classNames === nodeClassNames;\n\n              if (!matches) {\n                var nodeClassNamesSet = toOrderedSet(nodeClassNames);\n                matches = classNamesSet.every(arrayIncludes(nodeClassNamesSet));\n              }\n\n              if (matches) {\n                ls.push(node);\n              }\n            }\n          }\n        });\n      }\n\n      return ls;\n    });\n  },\n  //document factory method:\n  createElement: function (tagName) {\n    var node = new Element();\n    node.ownerDocument = this;\n    node.nodeName = tagName;\n    node.tagName = tagName;\n    node.localName = tagName;\n    node.childNodes = new NodeList();\n    var attrs = node.attributes = new NamedNodeMap();\n    attrs._ownerElement = node;\n    return node;\n  },\n  createDocumentFragment: function () {\n    var node = new DocumentFragment();\n    node.ownerDocument = this;\n    node.childNodes = new NodeList();\n    return node;\n  },\n  createTextNode: function (data) {\n    var node = new Text();\n    node.ownerDocument = this;\n    node.appendData(data);\n    return node;\n  },\n  createComment: function (data) {\n    var node = new Comment();\n    node.ownerDocument = this;\n    node.appendData(data);\n    return node;\n  },\n  createCDATASection: function (data) {\n    var node = new CDATASection();\n    node.ownerDocument = this;\n    node.appendData(data);\n    return node;\n  },\n  createProcessingInstruction: function (target, data) {\n    var node = new ProcessingInstruction();\n    node.ownerDocument = this;\n    node.tagName = node.target = target;\n    node.nodeValue = node.data = data;\n    return node;\n  },\n  createAttribute: function (name) {\n    var node = new Attr();\n    node.ownerDocument = this;\n    node.name = name;\n    node.nodeName = name;\n    node.localName = name;\n    node.specified = true;\n    return node;\n  },\n  createEntityReference: function (name) {\n    var node = new EntityReference();\n    node.ownerDocument = this;\n    node.nodeName = name;\n    return node;\n  },\n  // Introduced in DOM Level 2:\n  createElementNS: function (namespaceURI, qualifiedName) {\n    var node = new Element();\n    var pl = qualifiedName.split(':');\n    var attrs = node.attributes = new NamedNodeMap();\n    node.childNodes = new NodeList();\n    node.ownerDocument = this;\n    node.nodeName = qualifiedName;\n    node.tagName = qualifiedName;\n    node.namespaceURI = namespaceURI;\n\n    if (pl.length == 2) {\n      node.prefix = pl[0];\n      node.localName = pl[1];\n    } else {\n      //el.prefix = null;\n      node.localName = qualifiedName;\n    }\n\n    attrs._ownerElement = node;\n    return node;\n  },\n  // Introduced in DOM Level 2:\n  createAttributeNS: function (namespaceURI, qualifiedName) {\n    var node = new Attr();\n    var pl = qualifiedName.split(':');\n    node.ownerDocument = this;\n    node.nodeName = qualifiedName;\n    node.name = qualifiedName;\n    node.namespaceURI = namespaceURI;\n    node.specified = true;\n\n    if (pl.length == 2) {\n      node.prefix = pl[0];\n      node.localName = pl[1];\n    } else {\n      //el.prefix = null;\n      node.localName = qualifiedName;\n    }\n\n    return node;\n  }\n};\n\n_extends(Document, Node);\n\nfunction Element() {\n  this._nsMap = {};\n}\n\n;\nElement.prototype = {\n  nodeType: ELEMENT_NODE,\n  hasAttribute: function (name) {\n    return this.getAttributeNode(name) != null;\n  },\n  getAttribute: function (name) {\n    var attr = this.getAttributeNode(name);\n    return attr && attr.value || '';\n  },\n  getAttributeNode: function (name) {\n    return this.attributes.getNamedItem(name);\n  },\n  setAttribute: function (name, value) {\n    var attr = this.ownerDocument.createAttribute(name);\n    attr.value = attr.nodeValue = \"\" + value;\n    this.setAttributeNode(attr);\n  },\n  removeAttribute: function (name) {\n    var attr = this.getAttributeNode(name);\n    attr && this.removeAttributeNode(attr);\n  },\n  //four real opeartion method\n  appendChild: function (newChild) {\n    if (newChild.nodeType === DOCUMENT_FRAGMENT_NODE) {\n      return this.insertBefore(newChild, null);\n    } else {\n      return _appendSingleChild(this, newChild);\n    }\n  },\n  setAttributeNode: function (newAttr) {\n    return this.attributes.setNamedItem(newAttr);\n  },\n  setAttributeNodeNS: function (newAttr) {\n    return this.attributes.setNamedItemNS(newAttr);\n  },\n  removeAttributeNode: function (oldAttr) {\n    //console.log(this == oldAttr.ownerElement)\n    return this.attributes.removeNamedItem(oldAttr.nodeName);\n  },\n  //get real attribute name,and remove it by removeAttributeNode\n  removeAttributeNS: function (namespaceURI, localName) {\n    var old = this.getAttributeNodeNS(namespaceURI, localName);\n    old && this.removeAttributeNode(old);\n  },\n  hasAttributeNS: function (namespaceURI, localName) {\n    return this.getAttributeNodeNS(namespaceURI, localName) != null;\n  },\n  getAttributeNS: function (namespaceURI, localName) {\n    var attr = this.getAttributeNodeNS(namespaceURI, localName);\n    return attr && attr.value || '';\n  },\n  setAttributeNS: function (namespaceURI, qualifiedName, value) {\n    var attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n    attr.value = attr.nodeValue = \"\" + value;\n    this.setAttributeNode(attr);\n  },\n  getAttributeNodeNS: function (namespaceURI, localName) {\n    return this.attributes.getNamedItemNS(namespaceURI, localName);\n  },\n  getElementsByTagName: function (tagName) {\n    return new LiveNodeList(this, function (base) {\n      var ls = [];\n\n      _visitNode(base, function (node) {\n        if (node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)) {\n          ls.push(node);\n        }\n      });\n\n      return ls;\n    });\n  },\n  getElementsByTagNameNS: function (namespaceURI, localName) {\n    return new LiveNodeList(this, function (base) {\n      var ls = [];\n\n      _visitNode(base, function (node) {\n        if (node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)) {\n          ls.push(node);\n        }\n      });\n\n      return ls;\n    });\n  }\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n_extends(Element, Node);\n\nfunction Attr() {}\n\n;\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n\n_extends(Attr, Node);\n\nfunction CharacterData() {}\n\n;\nCharacterData.prototype = {\n  data: '',\n  substringData: function (offset, count) {\n    return this.data.substring(offset, offset + count);\n  },\n  appendData: function (text) {\n    text = this.data + text;\n    this.nodeValue = this.data = text;\n    this.length = text.length;\n  },\n  insertData: function (offset, text) {\n    this.replaceData(offset, 0, text);\n  },\n  appendChild: function (newChild) {\n    throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR]);\n  },\n  deleteData: function (offset, count) {\n    this.replaceData(offset, count, \"\");\n  },\n  replaceData: function (offset, count, text) {\n    var start = this.data.substring(0, offset);\n    var end = this.data.substring(offset + count);\n    text = start + text + end;\n    this.nodeValue = this.data = text;\n    this.length = text.length;\n  }\n};\n\n_extends(CharacterData, Node);\n\nfunction Text() {}\n\n;\nText.prototype = {\n  nodeName: \"#text\",\n  nodeType: TEXT_NODE,\n  splitText: function (offset) {\n    var text = this.data;\n    var newText = text.substring(offset);\n    text = text.substring(0, offset);\n    this.data = this.nodeValue = text;\n    this.length = text.length;\n    var newNode = this.ownerDocument.createTextNode(newText);\n\n    if (this.parentNode) {\n      this.parentNode.insertBefore(newNode, this.nextSibling);\n    }\n\n    return newNode;\n  }\n};\n\n_extends(Text, CharacterData);\n\nfunction Comment() {}\n\n;\nComment.prototype = {\n  nodeName: \"#comment\",\n  nodeType: COMMENT_NODE\n};\n\n_extends(Comment, CharacterData);\n\nfunction CDATASection() {}\n\n;\nCDATASection.prototype = {\n  nodeName: \"#cdata-section\",\n  nodeType: CDATA_SECTION_NODE\n};\n\n_extends(CDATASection, CharacterData);\n\nfunction DocumentType() {}\n\n;\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n\n_extends(DocumentType, Node);\n\nfunction Notation() {}\n\n;\nNotation.prototype.nodeType = NOTATION_NODE;\n\n_extends(Notation, Node);\n\nfunction Entity() {}\n\n;\nEntity.prototype.nodeType = ENTITY_NODE;\n\n_extends(Entity, Node);\n\nfunction EntityReference() {}\n\n;\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n\n_extends(EntityReference, Node);\n\nfunction DocumentFragment() {}\n\n;\nDocumentFragment.prototype.nodeName = \"#document-fragment\";\nDocumentFragment.prototype.nodeType = DOCUMENT_FRAGMENT_NODE;\n\n_extends(DocumentFragment, Node);\n\nfunction ProcessingInstruction() {}\n\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n\n_extends(ProcessingInstruction, Node);\n\nfunction XMLSerializer() {}\n\nXMLSerializer.prototype.serializeToString = function (node, isHtml, nodeFilter) {\n  return nodeSerializeToString.call(node, isHtml, nodeFilter);\n};\n\nNode.prototype.toString = nodeSerializeToString;\n\nfunction nodeSerializeToString(isHtml, nodeFilter) {\n  var buf = [];\n  var refNode = this.nodeType == 9 && this.documentElement || this;\n  var prefix = refNode.prefix;\n  var uri = refNode.namespaceURI;\n\n  if (uri && prefix == null) {\n    //console.log(prefix)\n    var prefix = refNode.lookupPrefix(uri);\n\n    if (prefix == null) {\n      //isHTML = true;\n      var visibleNamespaces = [{\n        namespace: uri,\n        prefix: null\n      } //{namespace:uri,prefix:''}\n      ];\n    }\n  }\n\n  serializeToString(this, buf, isHtml, nodeFilter, visibleNamespaces); //console.log('###',this.nodeType,uri,prefix,buf.join(''))\n\n  return buf.join('');\n}\n\nfunction needNamespaceDefine(node, isHTML, visibleNamespaces) {\n  var prefix = node.prefix || '';\n  var uri = node.namespaceURI; // According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,\n  // and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :\n  // > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.\n  // in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)\n  // and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :\n  // > [...] Furthermore, the attribute value [...] must not be an empty string.\n  // so serializing empty namespace value like xmlns:ds=\"\" would produce an invalid XML document.\n\n  if (!uri) {\n    return false;\n  }\n\n  if (prefix === \"xml\" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {\n    return false;\n  }\n\n  var i = visibleNamespaces.length;\n\n  while (i--) {\n    var ns = visibleNamespaces[i]; // get namespace prefix\n\n    if (ns.prefix === prefix) {\n      return ns.namespace !== uri;\n    }\n  }\n\n  return true;\n}\n/**\r\n * Well-formed constraint: No < in Attribute Values\r\n * The replacement text of any entity referred to directly or indirectly in an attribute value must not contain a <.\r\n * @see https://www.w3.org/TR/xml/#CleanAttrVals\r\n * @see https://www.w3.org/TR/xml/#NT-AttValue\r\n */\n\n\nfunction addSerializedAttribute(buf, qualifiedName, value) {\n  buf.push(' ', qualifiedName, '=\"', value.replace(/[<&\"]/g, _xmlEncoder), '\"');\n}\n\nfunction serializeToString(node, buf, isHTML, nodeFilter, visibleNamespaces) {\n  if (!visibleNamespaces) {\n    visibleNamespaces = [];\n  }\n\n  if (nodeFilter) {\n    node = nodeFilter(node);\n\n    if (node) {\n      if (typeof node == 'string') {\n        buf.push(node);\n        return;\n      }\n    } else {\n      return;\n    } //buf.sort.apply(attrs, attributeSorter);\n\n  }\n\n  switch (node.nodeType) {\n    case ELEMENT_NODE:\n      var attrs = node.attributes;\n      var len = attrs.length;\n      var child = node.firstChild;\n      var nodeName = node.tagName;\n      isHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML;\n      var prefixedNodeName = nodeName;\n\n      if (!isHTML && !node.prefix && node.namespaceURI) {\n        var defaultNS; // lookup current default ns from `xmlns` attribute\n\n        for (var ai = 0; ai < attrs.length; ai++) {\n          if (attrs.item(ai).name === 'xmlns') {\n            defaultNS = attrs.item(ai).value;\n            break;\n          }\n        }\n\n        if (!defaultNS) {\n          // lookup current default ns in visibleNamespaces\n          for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n            var namespace = visibleNamespaces[nsi];\n\n            if (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {\n              defaultNS = namespace.namespace;\n              break;\n            }\n          }\n        }\n\n        if (defaultNS !== node.namespaceURI) {\n          for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n            var namespace = visibleNamespaces[nsi];\n\n            if (namespace.namespace === node.namespaceURI) {\n              if (namespace.prefix) {\n                prefixedNodeName = namespace.prefix + ':' + nodeName;\n              }\n\n              break;\n            }\n          }\n        }\n      }\n\n      buf.push('<', prefixedNodeName);\n\n      for (var i = 0; i < len; i++) {\n        // add namespaces for attributes\n        var attr = attrs.item(i);\n\n        if (attr.prefix == 'xmlns') {\n          visibleNamespaces.push({\n            prefix: attr.localName,\n            namespace: attr.value\n          });\n        } else if (attr.nodeName == 'xmlns') {\n          visibleNamespaces.push({\n            prefix: '',\n            namespace: attr.value\n          });\n        }\n      }\n\n      for (var i = 0; i < len; i++) {\n        var attr = attrs.item(i);\n\n        if (needNamespaceDefine(attr, isHTML, visibleNamespaces)) {\n          var prefix = attr.prefix || '';\n          var uri = attr.namespaceURI;\n          addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n          visibleNamespaces.push({\n            prefix: prefix,\n            namespace: uri\n          });\n        }\n\n        serializeToString(attr, buf, isHTML, nodeFilter, visibleNamespaces);\n      } // add namespace for current node\t\t\n\n\n      if (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {\n        var prefix = node.prefix || '';\n        var uri = node.namespaceURI;\n        addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n        visibleNamespaces.push({\n          prefix: prefix,\n          namespace: uri\n        });\n      }\n\n      if (child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)) {\n        buf.push('>'); //if is cdata child node\n\n        if (isHTML && /^script$/i.test(nodeName)) {\n          while (child) {\n            if (child.data) {\n              buf.push(child.data);\n            } else {\n              serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n            }\n\n            child = child.nextSibling;\n          }\n        } else {\n          while (child) {\n            serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n            child = child.nextSibling;\n          }\n        }\n\n        buf.push('</', prefixedNodeName, '>');\n      } else {\n        buf.push('/>');\n      } // remove added visible namespaces\n      //visibleNamespaces.length = startVisibleNamespaces;\n\n\n      return;\n\n    case DOCUMENT_NODE:\n    case DOCUMENT_FRAGMENT_NODE:\n      var child = node.firstChild;\n\n      while (child) {\n        serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n        child = child.nextSibling;\n      }\n\n      return;\n\n    case ATTRIBUTE_NODE:\n      return addSerializedAttribute(buf, node.name, node.value);\n\n    case TEXT_NODE:\n      /**\r\n       * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,\r\n       * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.\r\n       * If they are needed elsewhere, they must be escaped using either numeric character references or the strings\r\n       * `&amp;` and `&lt;` respectively.\r\n       * The right angle bracket (>) may be represented using the string \" &gt; \", and must, for compatibility,\r\n       * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,\r\n       * when that string is not marking the end of a CDATA section.\r\n       *\r\n       * In the content of elements, character data is any string of characters\r\n       * which does not contain the start-delimiter of any markup\r\n       * and does not include the CDATA-section-close delimiter, `]]>`.\r\n       *\r\n       * @see https://www.w3.org/TR/xml/#NT-CharData\r\n       */\n      return buf.push(node.data.replace(/[<&]/g, _xmlEncoder).replace(/]]>/g, ']]&gt;'));\n\n    case CDATA_SECTION_NODE:\n      return buf.push('<![CDATA[', node.data, ']]>');\n\n    case COMMENT_NODE:\n      return buf.push(\"<!--\", node.data, \"-->\");\n\n    case DOCUMENT_TYPE_NODE:\n      var pubid = node.publicId;\n      var sysid = node.systemId;\n      buf.push('<!DOCTYPE ', node.name);\n\n      if (pubid) {\n        buf.push(' PUBLIC ', pubid);\n\n        if (sysid && sysid != '.') {\n          buf.push(' ', sysid);\n        }\n\n        buf.push('>');\n      } else if (sysid && sysid != '.') {\n        buf.push(' SYSTEM ', sysid, '>');\n      } else {\n        var sub = node.internalSubset;\n\n        if (sub) {\n          buf.push(\" [\", sub, \"]\");\n        }\n\n        buf.push(\">\");\n      }\n\n      return;\n\n    case PROCESSING_INSTRUCTION_NODE:\n      return buf.push(\"<?\", node.target, \" \", node.data, \"?>\");\n\n    case ENTITY_REFERENCE_NODE:\n      return buf.push('&', node.nodeName, ';');\n    //case ENTITY_NODE:\n    //case NOTATION_NODE:\n\n    default:\n      buf.push('??', node.nodeName);\n  }\n}\n\nfunction importNode(doc, node, deep) {\n  var node2;\n\n  switch (node.nodeType) {\n    case ELEMENT_NODE:\n      node2 = node.cloneNode(false);\n      node2.ownerDocument = doc;\n    //var attrs = node2.attributes;\n    //var len = attrs.length;\n    //for(var i=0;i<len;i++){\n    //node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n    //}\n\n    case DOCUMENT_FRAGMENT_NODE:\n      break;\n\n    case ATTRIBUTE_NODE:\n      deep = true;\n      break;\n    //case ENTITY_REFERENCE_NODE:\n    //case PROCESSING_INSTRUCTION_NODE:\n    ////case TEXT_NODE:\n    //case CDATA_SECTION_NODE:\n    //case COMMENT_NODE:\n    //\tdeep = false;\n    //\tbreak;\n    //case DOCUMENT_NODE:\n    //case DOCUMENT_TYPE_NODE:\n    //cannot be imported.\n    //case ENTITY_NODE:\n    //case NOTATION_NODEï¼š\n    //can not hit in level3\n    //default:throw e;\n  }\n\n  if (!node2) {\n    node2 = node.cloneNode(false); //false\n  }\n\n  node2.ownerDocument = doc;\n  node2.parentNode = null;\n\n  if (deep) {\n    var child = node.firstChild;\n\n    while (child) {\n      node2.appendChild(importNode(doc, child, deep));\n      child = child.nextSibling;\n    }\n  }\n\n  return node2;\n} //\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\n\n\nfunction cloneNode(doc, node, deep) {\n  var node2 = new node.constructor();\n\n  for (var n in node) {\n    var v = node[n];\n\n    if (typeof v != 'object') {\n      if (v != node2[n]) {\n        node2[n] = v;\n      }\n    }\n  }\n\n  if (node.childNodes) {\n    node2.childNodes = new NodeList();\n  }\n\n  node2.ownerDocument = doc;\n\n  switch (node2.nodeType) {\n    case ELEMENT_NODE:\n      var attrs = node.attributes;\n      var attrs2 = node2.attributes = new NamedNodeMap();\n      var len = attrs.length;\n      attrs2._ownerElement = node2;\n\n      for (var i = 0; i < len; i++) {\n        node2.setAttributeNode(cloneNode(doc, attrs.item(i), true));\n      }\n\n      break;\n      ;\n\n    case ATTRIBUTE_NODE:\n      deep = true;\n  }\n\n  if (deep) {\n    var child = node.firstChild;\n\n    while (child) {\n      node2.appendChild(cloneNode(doc, child, deep));\n      child = child.nextSibling;\n    }\n  }\n\n  return node2;\n}\n\nfunction __set__(object, key, value) {\n  object[key] = value;\n} //do dynamic\n\n\ntry {\n  if (Object.defineProperty) {\n    Object.defineProperty(LiveNodeList.prototype, 'length', {\n      get: function () {\n        _updateLiveList(this);\n\n        return this.$$length;\n      }\n    });\n    Object.defineProperty(Node.prototype, 'textContent', {\n      get: function () {\n        return getTextContent(this);\n      },\n      set: function (data) {\n        switch (this.nodeType) {\n          case ELEMENT_NODE:\n          case DOCUMENT_FRAGMENT_NODE:\n            while (this.firstChild) {\n              this.removeChild(this.firstChild);\n            }\n\n            if (data || String(data)) {\n              this.appendChild(this.ownerDocument.createTextNode(data));\n            }\n\n            break;\n\n          default:\n            this.data = data;\n            this.value = data;\n            this.nodeValue = data;\n        }\n      }\n    });\n\n    function getTextContent(node) {\n      switch (node.nodeType) {\n        case ELEMENT_NODE:\n        case DOCUMENT_FRAGMENT_NODE:\n          var buf = [];\n          node = node.firstChild;\n\n          while (node) {\n            if (node.nodeType !== 7 && node.nodeType !== 8) {\n              buf.push(getTextContent(node));\n            }\n\n            node = node.nextSibling;\n          }\n\n          return buf.join('');\n\n        default:\n          return node.nodeValue;\n      }\n    }\n\n    __set__ = function (object, key, value) {\n      //console.log(value)\n      object['$$' + key] = value;\n    };\n  }\n} catch (e) {//ie8\n} //if(typeof require == 'function'){\n\n\nexports.DocumentType = DocumentType;\nexports.DOMException = DOMException;\nexports.DOMImplementation = DOMImplementation;\nexports.Element = Element;\nexports.Node = Node;\nexports.NodeList = NodeList;\nexports.XMLSerializer = XMLSerializer; //}","map":{"version":3,"sources":["B:/Duoc/Portafolio_de_titulo/Git/Turismo-Real/Front/Pwa/node_modules/@xmldom/xmldom/lib/dom.js"],"names":["conventions","require","NAMESPACE","notEmptyString","input","splitOnASCIIWhitespace","split","filter","orderedSetReducer","current","element","hasOwnProperty","toOrderedSet","list","Object","keys","reduce","arrayIncludes","indexOf","copy","src","dest","p","_extends","Class","Super","pt","prototype","t","constructor","console","error","NodeType","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","ExceptionCode","ExceptionMessage","INDEX_SIZE_ERR","DOMSTRING_SIZE_ERR","HIERARCHY_REQUEST_ERR","WRONG_DOCUMENT_ERR","INVALID_CHARACTER_ERR","NO_DATA_ALLOWED_ERR","NO_MODIFICATION_ALLOWED_ERR","NOT_FOUND_ERR","NOT_SUPPORTED_ERR","INUSE_ATTRIBUTE_ERR","INVALID_STATE_ERR","SYNTAX_ERR","INVALID_MODIFICATION_ERR","NAMESPACE_ERR","INVALID_ACCESS_ERR","DOMException","code","message","Error","call","captureStackTrace","NodeList","length","item","index","toString","isHTML","nodeFilter","buf","i","serializeToString","join","LiveNodeList","node","refresh","_node","_refresh","_updateLiveList","inc","_inc","ownerDocument","ls","__set__","NamedNodeMap","_findNodeIndex","_addNamedNode","el","newAttr","oldAttr","ownerElement","doc","_onRemoveAttribute","_onAddAttribute","_removeNamedNode","attr","lastIndex","tagName","getNamedItem","key","nodeName","setNamedItem","_ownerElement","setNamedItemNS","getNamedItemNS","namespaceURI","localName","removeNamedItem","removeNamedItemNS","DOMImplementation","hasFeature","feature","version","createDocument","qualifiedName","doctype","Document","implementation","childNodes","appendChild","root","createElementNS","createDocumentType","publicId","systemId","DocumentType","name","Node","firstChild","lastChild","previousSibling","nextSibling","attributes","parentNode","nodeValue","prefix","insertBefore","newChild","refChild","_insertBefore","replaceChild","oldChild","removeChild","_removeChild","hasChildNodes","cloneNode","deep","normalize","child","next","nodeType","appendData","data","isSupported","hasAttributes","lookupPrefix","map","_nsMap","n","lookupNamespaceURI","isDefaultNamespace","_xmlEncoder","c","charCodeAt","_visitNode","callback","ns","XMLNS","value","remove","_onUpdateChild","cs","previous","nextChild","cp","newFirst","newLast","pre","_appendSingleChild","documentElement","importNode","importedNode","getElementById","id","rtv","getAttribute","getElementsByClassName","classNames","classNamesSet","base","nodeClassNames","matches","nodeClassNamesSet","every","push","createElement","Element","attrs","createDocumentFragment","DocumentFragment","createTextNode","Text","createComment","Comment","createCDATASection","CDATASection","createProcessingInstruction","target","ProcessingInstruction","createAttribute","Attr","specified","createEntityReference","EntityReference","pl","createAttributeNS","hasAttribute","getAttributeNode","setAttribute","setAttributeNode","removeAttribute","removeAttributeNode","setAttributeNodeNS","removeAttributeNS","old","getAttributeNodeNS","hasAttributeNS","getAttributeNS","setAttributeNS","getElementsByTagName","getElementsByTagNameNS","CharacterData","substringData","offset","count","substring","text","insertData","replaceData","deleteData","start","end","splitText","newText","newNode","Notation","Entity","XMLSerializer","isHtml","nodeSerializeToString","refNode","uri","visibleNamespaces","namespace","needNamespaceDefine","XML","addSerializedAttribute","replace","len","prefixedNodeName","defaultNS","ai","nsi","test","slice","pubid","sysid","sub","internalSubset","node2","v","attrs2","object","defineProperty","get","$$length","getTextContent","set","String","e","exports"],"mappings":"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","sourcesContent":["var conventions = require(\"./conventions\");\r\n\r\nvar NAMESPACE = conventions.NAMESPACE;\r\n\r\n/**\r\n * A prerequisite for `[].filter`, to drop elements that are empty\r\n * @param {string} input\r\n * @returns {boolean}\r\n */\r\nfunction notEmptyString (input) {\r\n\treturn input !== ''\r\n}\r\n/**\r\n * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace\r\n * @see https://infra.spec.whatwg.org/#ascii-whitespace\r\n *\r\n * @param {string} input\r\n * @returns {string[]} (can be empty)\r\n */\r\nfunction splitOnASCIIWhitespace(input) {\r\n\t// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE\r\n\treturn input ? input.split(/[\\t\\n\\f\\r ]+/).filter(notEmptyString) : []\r\n}\r\n\r\n/**\r\n * Adds element as a key to current if it is not already present.\r\n *\r\n * @param {Record<string, boolean | undefined>} current\r\n * @param {string} element\r\n * @returns {Record<string, boolean | undefined>}\r\n */\r\nfunction orderedSetReducer (current, element) {\r\n\tif (!current.hasOwnProperty(element)) {\r\n\t\tcurrent[element] = true;\r\n\t}\r\n\treturn current;\r\n}\r\n\r\n/**\r\n * @see https://infra.spec.whatwg.org/#ordered-set\r\n * @param {string} input\r\n * @returns {string[]}\r\n */\r\nfunction toOrderedSet(input) {\r\n\tif (!input) return [];\r\n\tvar list = splitOnASCIIWhitespace(input);\r\n\treturn Object.keys(list.reduce(orderedSetReducer, {}))\r\n}\r\n\r\n/**\r\n * Uses `list.indexOf` to implement something like `Array.prototype.includes`,\r\n * which we can not rely on being available.\r\n *\r\n * @param {any[]} list\r\n * @returns {function(any): boolean}\r\n */\r\nfunction arrayIncludes (list) {\r\n\treturn function(element) {\r\n\t\treturn list && list.indexOf(element) !== -1;\r\n\t}\r\n}\r\n\r\nfunction copy(src,dest){\r\n\tfor(var p in src){\r\n\t\tdest[p] = src[p];\r\n\t}\r\n}\r\n\r\n/**\r\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\r\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\r\n */\r\nfunction _extends(Class,Super){\r\n\tvar pt = Class.prototype;\r\n\tif(!(pt instanceof Super)){\r\n\t\tfunction t(){};\r\n\t\tt.prototype = Super.prototype;\r\n\t\tt = new t();\r\n\t\tcopy(pt,t);\r\n\t\tClass.prototype = pt = t;\r\n\t}\r\n\tif(pt.constructor != Class){\r\n\t\tif(typeof Class != 'function'){\r\n\t\t\tconsole.error(\"unknown Class:\"+Class)\r\n\t\t}\r\n\t\tpt.constructor = Class\r\n\t}\r\n}\r\n\r\n// Node Types\r\nvar NodeType = {}\r\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\r\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\r\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\r\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\r\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\r\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\r\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\r\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\r\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\r\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\r\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\r\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\r\n\r\n// ExceptionCode\r\nvar ExceptionCode = {}\r\nvar ExceptionMessage = {};\r\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\r\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\r\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\r\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\r\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\r\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\r\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\r\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\r\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\r\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\r\n//level2\r\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\r\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\r\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\r\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\r\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\r\n\r\n/**\r\n * DOM Level 2\r\n * Object DOMException\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\r\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\r\n */\r\nfunction DOMException(code, message) {\r\n\tif(message instanceof Error){\r\n\t\tvar error = message;\r\n\t}else{\r\n\t\terror = this;\r\n\t\tError.call(this, ExceptionMessage[code]);\r\n\t\tthis.message = ExceptionMessage[code];\r\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\r\n\t}\r\n\terror.code = code;\r\n\tif(message) this.message = this.message + \": \" + message;\r\n\treturn error;\r\n};\r\nDOMException.prototype = Error.prototype;\r\ncopy(ExceptionCode,DOMException)\r\n\r\n/**\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\r\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\r\n * The items in the NodeList are accessible via an integral index, starting from 0.\r\n */\r\nfunction NodeList() {\r\n};\r\nNodeList.prototype = {\r\n\t/**\r\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\r\n\t * @standard level1\r\n\t */\r\n\tlength:0, \r\n\t/**\r\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\r\n\t * @standard level1\r\n\t * @param index  unsigned long \r\n\t *   Index into the collection.\r\n\t * @return Node\r\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \r\n\t */\r\n\titem: function(index) {\r\n\t\treturn this[index] || null;\r\n\t},\r\n\ttoString:function(isHTML,nodeFilter){\r\n\t\tfor(var buf = [], i = 0;i<this.length;i++){\r\n\t\t\tserializeToString(this[i],buf,isHTML,nodeFilter);\r\n\t\t}\r\n\t\treturn buf.join('');\r\n\t}\r\n};\r\n\r\nfunction LiveNodeList(node,refresh){\r\n\tthis._node = node;\r\n\tthis._refresh = refresh\r\n\t_updateLiveList(this);\r\n}\r\nfunction _updateLiveList(list){\r\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\r\n\tif(list._inc != inc){\r\n\t\tvar ls = list._refresh(list._node);\r\n\t\t//console.log(ls.length)\r\n\t\t__set__(list,'length',ls.length);\r\n\t\tcopy(ls,list);\r\n\t\tlist._inc = inc;\r\n\t}\r\n}\r\nLiveNodeList.prototype.item = function(i){\r\n\t_updateLiveList(this);\r\n\treturn this[i];\r\n}\r\n\r\n_extends(LiveNodeList,NodeList);\r\n\r\n/**\r\n * Objects implementing the NamedNodeMap interface are used\r\n * to represent collections of nodes that can be accessed by name.\r\n * Note that NamedNodeMap does not inherit from NodeList;\r\n * NamedNodeMaps are not maintained in any particular order.\r\n * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,\r\n * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,\r\n * and does not imply that the DOM specifies an order to these Nodes.\r\n * NamedNodeMap objects in the DOM are live.\r\n * used for attributes or DocumentType entities \r\n */\r\nfunction NamedNodeMap() {\r\n};\r\n\r\nfunction _findNodeIndex(list,node){\r\n\tvar i = list.length;\r\n\twhile(i--){\r\n\t\tif(list[i] === node){return i}\r\n\t}\r\n}\r\n\r\nfunction _addNamedNode(el,list,newAttr,oldAttr){\r\n\tif(oldAttr){\r\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\r\n\t}else{\r\n\t\tlist[list.length++] = newAttr;\r\n\t}\r\n\tif(el){\r\n\t\tnewAttr.ownerElement = el;\r\n\t\tvar doc = el.ownerDocument;\r\n\t\tif(doc){\r\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\r\n\t\t\t_onAddAttribute(doc,el,newAttr);\r\n\t\t}\r\n\t}\r\n}\r\nfunction _removeNamedNode(el,list,attr){\r\n\t//console.log('remove attr:'+attr)\r\n\tvar i = _findNodeIndex(list,attr);\r\n\tif(i>=0){\r\n\t\tvar lastIndex = list.length-1\r\n\t\twhile(i<lastIndex){\r\n\t\t\tlist[i] = list[++i]\r\n\t\t}\r\n\t\tlist.length = lastIndex;\r\n\t\tif(el){\r\n\t\t\tvar doc = el.ownerDocument;\r\n\t\t\tif(doc){\r\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\r\n\t\t\t\tattr.ownerElement = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tthrow DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))\r\n\t}\r\n}\r\nNamedNodeMap.prototype = {\r\n\tlength:0,\r\n\titem:NodeList.prototype.item,\r\n\tgetNamedItem: function(key) {\r\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\r\n//\t\t\treturn null;\r\n//\t\t}\r\n\t\t//console.log()\r\n\t\tvar i = this.length;\r\n\t\twhile(i--){\r\n\t\t\tvar attr = this[i];\r\n\t\t\t//console.log(attr.nodeName,key)\r\n\t\t\tif(attr.nodeName == key){\r\n\t\t\t\treturn attr;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tsetNamedItem: function(attr) {\r\n\t\tvar el = attr.ownerElement;\r\n\t\tif(el && el!=this._ownerElement){\r\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\r\n\t\t}\r\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\r\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\r\n\t\treturn oldAttr;\r\n\t},\r\n\t/* returns Node */\r\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\r\n\t\tvar el = attr.ownerElement, oldAttr;\r\n\t\tif(el && el!=this._ownerElement){\r\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\r\n\t\t}\r\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\r\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\r\n\t\treturn oldAttr;\r\n\t},\r\n\r\n\t/* returns Node */\r\n\tremoveNamedItem: function(key) {\r\n\t\tvar attr = this.getNamedItem(key);\r\n\t\t_removeNamedNode(this._ownerElement,this,attr);\r\n\t\treturn attr;\r\n\t\t\r\n\t\t\r\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\r\n\t\r\n\t//for level2\r\n\tremoveNamedItemNS:function(namespaceURI,localName){\r\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\r\n\t\t_removeNamedNode(this._ownerElement,this,attr);\r\n\t\treturn attr;\r\n\t},\r\n\tgetNamedItemNS: function(namespaceURI, localName) {\r\n\t\tvar i = this.length;\r\n\t\twhile(i--){\r\n\t\t\tvar node = this[i];\r\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};\r\n\r\n/**\r\n * The DOMImplementation interface represents an object providing methods\r\n * which are not dependent on any particular document.\r\n * Such an object is returned by the `Document.implementation` property.\r\n *\r\n * __The individual methods describe the differences compared to the specs.__\r\n *\r\n * @constructor\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN\r\n * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)\r\n * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core\r\n * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core\r\n * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard\r\n */\r\nfunction DOMImplementation() {\r\n}\r\n\r\nDOMImplementation.prototype = {\r\n\t/**\r\n\t * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.\r\n\t * The different implementations fairly diverged in what kind of features were reported.\r\n\t * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.\r\n\t *\r\n\t * @deprecated It is deprecated and modern browsers return true in all cases.\r\n\t *\r\n\t * @param {string} feature\r\n\t * @param {string} [version]\r\n\t * @returns {boolean} always true\r\n\t *\r\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN\r\n\t * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core\r\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard\r\n\t */\r\n\thasFeature: function(feature, version) {\r\n\t\t\treturn true;\r\n\t},\r\n\t/**\r\n\t * Creates an XML Document object of the specified type with its document element.\r\n\t *\r\n\t * __It behaves slightly different from the description in the living standard__:\r\n\t * - There is no interface/class `XMLDocument`, it returns a `Document` instance.\r\n\t * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.\r\n\t * - this implementation is not validating names or qualified names\r\n\t *   (when parsing XML strings, the SAX parser takes care of that)\r\n\t *\r\n\t * @param {string|null} namespaceURI\r\n\t * @param {string} qualifiedName\r\n\t * @param {DocumentType=null} doctype\r\n\t * @returns {Document}\r\n\t *\r\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN\r\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)\r\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core\r\n\t *\r\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\r\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\r\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\r\n\t */\r\n\tcreateDocument: function(namespaceURI,  qualifiedName, doctype){\r\n\t\tvar doc = new Document();\r\n\t\tdoc.implementation = this;\r\n\t\tdoc.childNodes = new NodeList();\r\n\t\tdoc.doctype = doctype || null;\r\n\t\tif (doctype){\r\n\t\t\tdoc.appendChild(doctype);\r\n\t\t}\r\n\t\tif (qualifiedName){\r\n\t\t\tvar root = doc.createElementNS(namespaceURI, qualifiedName);\r\n\t\t\tdoc.appendChild(root);\r\n\t\t}\r\n\t\treturn doc;\r\n\t},\r\n\t/**\r\n\t * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.\r\n\t *\r\n\t * __This behavior is slightly different from the in the specs__:\r\n\t * - this implementation is not validating names or qualified names\r\n\t *   (when parsing XML strings, the SAX parser takes care of that)\r\n\t *\r\n\t * @param {string} qualifiedName\r\n\t * @param {string} [publicId]\r\n\t * @param {string} [systemId]\r\n\t * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation\r\n\t * \t\t\t\t  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`\r\n\t *\r\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN\r\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core\r\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard\r\n\t *\r\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\r\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\r\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\r\n\t */\r\n\tcreateDocumentType: function(qualifiedName, publicId, systemId){\r\n\t\tvar node = new DocumentType();\r\n\t\tnode.name = qualifiedName;\r\n\t\tnode.nodeName = qualifiedName;\r\n\t\tnode.publicId = publicId || '';\r\n\t\tnode.systemId = systemId || '';\r\n\r\n\t\treturn node;\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\r\n */\r\n\r\nfunction Node() {\r\n};\r\n\r\nNode.prototype = {\r\n\tfirstChild : null,\r\n\tlastChild : null,\r\n\tpreviousSibling : null,\r\n\tnextSibling : null,\r\n\tattributes : null,\r\n\tparentNode : null,\r\n\tchildNodes : null,\r\n\townerDocument : null,\r\n\tnodeValue : null,\r\n\tnamespaceURI : null,\r\n\tprefix : null,\r\n\tlocalName : null,\r\n\t// Modified in DOM Level 2:\r\n\tinsertBefore:function(newChild, refChild){//raises \r\n\t\treturn _insertBefore(this,newChild,refChild);\r\n\t},\r\n\treplaceChild:function(newChild, oldChild){//raises \r\n\t\tthis.insertBefore(newChild,oldChild);\r\n\t\tif(oldChild){\r\n\t\t\tthis.removeChild(oldChild);\r\n\t\t}\r\n\t},\r\n\tremoveChild:function(oldChild){\r\n\t\treturn _removeChild(this,oldChild);\r\n\t},\r\n\tappendChild:function(newChild){\r\n\t\treturn this.insertBefore(newChild,null);\r\n\t},\r\n\thasChildNodes:function(){\r\n\t\treturn this.firstChild != null;\r\n\t},\r\n\tcloneNode:function(deep){\r\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\r\n\t},\r\n\t// Modified in DOM Level 2:\r\n\tnormalize:function(){\r\n\t\tvar child = this.firstChild;\r\n\t\twhile(child){\r\n\t\t\tvar next = child.nextSibling;\r\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\r\n\t\t\t\tthis.removeChild(next);\r\n\t\t\t\tchild.appendData(next.data);\r\n\t\t\t}else{\r\n\t\t\t\tchild.normalize();\r\n\t\t\t\tchild = next;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n  \t// Introduced in DOM Level 2:\r\n\tisSupported:function(feature, version){\r\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\r\n\t},\r\n    // Introduced in DOM Level 2:\r\n    hasAttributes:function(){\r\n    \treturn this.attributes.length>0;\r\n    },\r\n\t/**\r\n\t * Look up the prefix associated to the given namespace URI, starting from this node.\r\n\t * **The default namespace declarations are ignored by this method.**\r\n\t * See Namespace Prefix Lookup for details on the algorithm used by this method.\r\n\t *\r\n\t * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._\r\n\t *\r\n\t * @param {string | null} namespaceURI\r\n\t * @returns {string | null}\r\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix\r\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo\r\n\t * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix\r\n\t * @see https://github.com/xmldom/xmldom/issues/322\r\n\t */\r\n    lookupPrefix:function(namespaceURI){\r\n    \tvar el = this;\r\n    \twhile(el){\r\n    \t\tvar map = el._nsMap;\r\n    \t\t//console.dir(map)\r\n    \t\tif(map){\r\n    \t\t\tfor(var n in map){\r\n    \t\t\t\tif(map[n] == namespaceURI){\r\n    \t\t\t\t\treturn n;\r\n    \t\t\t\t}\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\r\n    \t}\r\n    \treturn null;\r\n    },\r\n    // Introduced in DOM Level 3:\r\n    lookupNamespaceURI:function(prefix){\r\n    \tvar el = this;\r\n    \twhile(el){\r\n    \t\tvar map = el._nsMap;\r\n    \t\t//console.dir(map)\r\n    \t\tif(map){\r\n    \t\t\tif(prefix in map){\r\n    \t\t\t\treturn map[prefix] ;\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\r\n    \t}\r\n    \treturn null;\r\n    },\r\n    // Introduced in DOM Level 3:\r\n    isDefaultNamespace:function(namespaceURI){\r\n    \tvar prefix = this.lookupPrefix(namespaceURI);\r\n    \treturn prefix == null;\r\n    }\r\n};\r\n\r\n\r\nfunction _xmlEncoder(c){\r\n\treturn c == '<' && '&lt;' ||\r\n         c == '>' && '&gt;' ||\r\n         c == '&' && '&amp;' ||\r\n         c == '\"' && '&quot;' ||\r\n         '&#'+c.charCodeAt()+';'\r\n}\r\n\r\n\r\ncopy(NodeType,Node);\r\ncopy(NodeType,Node.prototype);\r\n\r\n/**\r\n * @param callback return true for continue,false for break\r\n * @return boolean true: break visit;\r\n */\r\nfunction _visitNode(node,callback){\r\n\tif(callback(node)){\r\n\t\treturn true;\r\n\t}\r\n\tif(node = node.firstChild){\r\n\t\tdo{\r\n\t\t\tif(_visitNode(node,callback)){return true}\r\n        }while(node=node.nextSibling)\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction Document(){\r\n}\r\n\r\nfunction _onAddAttribute(doc,el,newAttr){\r\n\tdoc && doc._inc++;\r\n\tvar ns = newAttr.namespaceURI ;\r\n\tif(ns === NAMESPACE.XMLNS){\r\n\t\t//update namespace\r\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\r\n\t}\r\n}\r\n\r\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\r\n\tdoc && doc._inc++;\r\n\tvar ns = newAttr.namespaceURI ;\r\n\tif(ns === NAMESPACE.XMLNS){\r\n\t\t//update namespace\r\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\r\n\t}\r\n}\r\n\r\nfunction _onUpdateChild(doc,el,newChild){\r\n\tif(doc && doc._inc){\r\n\t\tdoc._inc++;\r\n\t\t//update childNodes\r\n\t\tvar cs = el.childNodes;\r\n\t\tif(newChild){\r\n\t\t\tcs[cs.length++] = newChild;\r\n\t\t}else{\r\n\t\t\t//console.log(1)\r\n\t\t\tvar child = el.firstChild;\r\n\t\t\tvar i = 0;\r\n\t\t\twhile(child){\r\n\t\t\t\tcs[i++] = child;\r\n\t\t\t\tchild =child.nextSibling;\r\n\t\t\t}\r\n\t\t\tcs.length = i;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * attributes;\r\n * children;\r\n * \r\n * writeable properties:\r\n * nodeValue,Attr:value,CharacterData:data\r\n * prefix\r\n */\r\nfunction _removeChild(parentNode,child){\r\n\tvar previous = child.previousSibling;\r\n\tvar next = child.nextSibling;\r\n\tif(previous){\r\n\t\tprevious.nextSibling = next;\r\n\t}else{\r\n\t\tparentNode.firstChild = next\r\n\t}\r\n\tif(next){\r\n\t\tnext.previousSibling = previous;\r\n\t}else{\r\n\t\tparentNode.lastChild = previous;\r\n\t}\r\n\t_onUpdateChild(parentNode.ownerDocument,parentNode);\r\n\treturn child;\r\n}\r\n/**\r\n * preformance key(refChild == null)\r\n */\r\nfunction _insertBefore(parentNode,newChild,nextChild){\r\n\tvar cp = newChild.parentNode;\r\n\tif(cp){\r\n\t\tcp.removeChild(newChild);//remove and update\r\n\t}\r\n\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\r\n\t\tvar newFirst = newChild.firstChild;\r\n\t\tif (newFirst == null) {\r\n\t\t\treturn newChild;\r\n\t\t}\r\n\t\tvar newLast = newChild.lastChild;\r\n\t}else{\r\n\t\tnewFirst = newLast = newChild;\r\n\t}\r\n\tvar pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\r\n\r\n\tnewFirst.previousSibling = pre;\r\n\tnewLast.nextSibling = nextChild;\r\n\t\r\n\t\r\n\tif(pre){\r\n\t\tpre.nextSibling = newFirst;\r\n\t}else{\r\n\t\tparentNode.firstChild = newFirst;\r\n\t}\r\n\tif(nextChild == null){\r\n\t\tparentNode.lastChild = newLast;\r\n\t}else{\r\n\t\tnextChild.previousSibling = newLast;\r\n\t}\r\n\tdo{\r\n\t\tnewFirst.parentNode = parentNode;\r\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\r\n\t_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);\r\n\t//console.log(parentNode.lastChild.nextSibling == null)\r\n\tif (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\r\n\t\tnewChild.firstChild = newChild.lastChild = null;\r\n\t}\r\n\treturn newChild;\r\n}\r\nfunction _appendSingleChild(parentNode,newChild){\r\n\tvar cp = newChild.parentNode;\r\n\tif(cp){\r\n\t\tvar pre = parentNode.lastChild;\r\n\t\tcp.removeChild(newChild);//remove and update\r\n\t\tvar pre = parentNode.lastChild;\r\n\t}\r\n\tvar pre = parentNode.lastChild;\r\n\tnewChild.parentNode = parentNode;\r\n\tnewChild.previousSibling = pre;\r\n\tnewChild.nextSibling = null;\r\n\tif(pre){\r\n\t\tpre.nextSibling = newChild;\r\n\t}else{\r\n\t\tparentNode.firstChild = newChild;\r\n\t}\r\n\tparentNode.lastChild = newChild;\r\n\t_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);\r\n\treturn newChild;\r\n\t//console.log(\"__aa\",parentNode.lastChild.nextSibling == null)\r\n}\r\nDocument.prototype = {\r\n\t//implementation : null,\r\n\tnodeName :  '#document',\r\n\tnodeType :  DOCUMENT_NODE,\r\n\t/**\r\n\t * The DocumentType node of the document.\r\n\t *\r\n\t * @readonly\r\n\t * @type DocumentType\r\n\t */\r\n\tdoctype :  null,\r\n\tdocumentElement :  null,\r\n\t_inc : 1,\r\n\r\n\tinsertBefore :  function(newChild, refChild){//raises\r\n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\r\n\t\t\tvar child = newChild.firstChild;\r\n\t\t\twhile(child){\r\n\t\t\t\tvar next = child.nextSibling;\r\n\t\t\t\tthis.insertBefore(child,refChild);\r\n\t\t\t\tchild = next;\r\n\t\t\t}\r\n\t\t\treturn newChild;\r\n\t\t}\r\n\t\tif(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){\r\n\t\t\tthis.documentElement = newChild;\r\n\t\t}\r\n\r\n\t\treturn _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;\r\n\t},\r\n\tremoveChild :  function(oldChild){\r\n\t\tif(this.documentElement == oldChild){\r\n\t\t\tthis.documentElement = null;\r\n\t\t}\r\n\t\treturn _removeChild(this,oldChild);\r\n\t},\r\n\t// Introduced in DOM Level 2:\r\n\timportNode : function(importedNode,deep){\r\n\t\treturn importNode(this,importedNode,deep);\r\n\t},\r\n\t// Introduced in DOM Level 2:\r\n\tgetElementById :\tfunction(id){\r\n\t\tvar rtv = null;\r\n\t\t_visitNode(this.documentElement,function(node){\r\n\t\t\tif(node.nodeType == ELEMENT_NODE){\r\n\t\t\t\tif(node.getAttribute('id') == id){\r\n\t\t\t\t\trtv = node;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn rtv;\r\n\t},\r\n\r\n\t/**\r\n\t * The `getElementsByClassName` method of `Document` interface returns an array-like object\r\n\t * of all child elements which have **all** of the given class name(s).\r\n\t *\r\n\t * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.\r\n\t *\r\n\t *\r\n\t * Warning: This is a live LiveNodeList.\r\n\t * Changes in the DOM will reflect in the array as the changes occur.\r\n\t * If an element selected by this array no longer qualifies for the selector,\r\n\t * it will automatically be removed. Be aware of this for iteration purposes.\r\n\t *\r\n\t * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace\r\n\t *\r\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\r\n\t * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname\r\n\t */\r\n\tgetElementsByClassName: function(classNames) {\r\n\t\tvar classNamesSet = toOrderedSet(classNames)\r\n\t\treturn new LiveNodeList(this, function(base) {\r\n\t\t\tvar ls = [];\r\n\t\t\tif (classNamesSet.length > 0) {\r\n\t\t\t\t_visitNode(base.documentElement, function(node) {\r\n\t\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE) {\r\n\t\t\t\t\t\tvar nodeClassNames = node.getAttribute('class')\r\n\t\t\t\t\t\t// can be null if the attribute does not exist\r\n\t\t\t\t\t\tif (nodeClassNames) {\r\n\t\t\t\t\t\t\t// before splitting and iterating just compare them for the most common case\r\n\t\t\t\t\t\t\tvar matches = classNames === nodeClassNames;\r\n\t\t\t\t\t\t\tif (!matches) {\r\n\t\t\t\t\t\t\t\tvar nodeClassNamesSet = toOrderedSet(nodeClassNames)\r\n\t\t\t\t\t\t\t\tmatches = classNamesSet.every(arrayIncludes(nodeClassNamesSet))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(matches) {\r\n\t\t\t\t\t\t\t\tls.push(node);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn ls;\r\n\t\t});\r\n\t},\r\n\r\n\t//document factory method:\r\n\tcreateElement :\tfunction(tagName){\r\n\t\tvar node = new Element();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.nodeName = tagName;\r\n\t\tnode.tagName = tagName;\r\n\t\tnode.localName = tagName;\r\n\t\tnode.childNodes = new NodeList();\r\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\r\n\t\tattrs._ownerElement = node;\r\n\t\treturn node;\r\n\t},\r\n\tcreateDocumentFragment :\tfunction(){\r\n\t\tvar node = new DocumentFragment();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.childNodes = new NodeList();\r\n\t\treturn node;\r\n\t},\r\n\tcreateTextNode :\tfunction(data){\r\n\t\tvar node = new Text();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.appendData(data)\r\n\t\treturn node;\r\n\t},\r\n\tcreateComment :\tfunction(data){\r\n\t\tvar node = new Comment();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.appendData(data)\r\n\t\treturn node;\r\n\t},\r\n\tcreateCDATASection :\tfunction(data){\r\n\t\tvar node = new CDATASection();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.appendData(data)\r\n\t\treturn node;\r\n\t},\r\n\tcreateProcessingInstruction :\tfunction(target,data){\r\n\t\tvar node = new ProcessingInstruction();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.tagName = node.target = target;\r\n\t\tnode.nodeValue= node.data = data;\r\n\t\treturn node;\r\n\t},\r\n\tcreateAttribute :\tfunction(name){\r\n\t\tvar node = new Attr();\r\n\t\tnode.ownerDocument\t= this;\r\n\t\tnode.name = name;\r\n\t\tnode.nodeName\t= name;\r\n\t\tnode.localName = name;\r\n\t\tnode.specified = true;\r\n\t\treturn node;\r\n\t},\r\n\tcreateEntityReference :\tfunction(name){\r\n\t\tvar node = new EntityReference();\r\n\t\tnode.ownerDocument\t= this;\r\n\t\tnode.nodeName\t= name;\r\n\t\treturn node;\r\n\t},\r\n\t// Introduced in DOM Level 2:\r\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\r\n\t\tvar node = new Element();\r\n\t\tvar pl = qualifiedName.split(':');\r\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\r\n\t\tnode.childNodes = new NodeList();\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.nodeName = qualifiedName;\r\n\t\tnode.tagName = qualifiedName;\r\n\t\tnode.namespaceURI = namespaceURI;\r\n\t\tif(pl.length == 2){\r\n\t\t\tnode.prefix = pl[0];\r\n\t\t\tnode.localName = pl[1];\r\n\t\t}else{\r\n\t\t\t//el.prefix = null;\r\n\t\t\tnode.localName = qualifiedName;\r\n\t\t}\r\n\t\tattrs._ownerElement = node;\r\n\t\treturn node;\r\n\t},\r\n\t// Introduced in DOM Level 2:\r\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\r\n\t\tvar node = new Attr();\r\n\t\tvar pl = qualifiedName.split(':');\r\n\t\tnode.ownerDocument = this;\r\n\t\tnode.nodeName = qualifiedName;\r\n\t\tnode.name = qualifiedName;\r\n\t\tnode.namespaceURI = namespaceURI;\r\n\t\tnode.specified = true;\r\n\t\tif(pl.length == 2){\r\n\t\t\tnode.prefix = pl[0];\r\n\t\t\tnode.localName = pl[1];\r\n\t\t}else{\r\n\t\t\t//el.prefix = null;\r\n\t\t\tnode.localName = qualifiedName;\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n};\r\n_extends(Document,Node);\r\n\r\n\r\nfunction Element() {\r\n\tthis._nsMap = {};\r\n};\r\nElement.prototype = {\r\n\tnodeType : ELEMENT_NODE,\r\n\thasAttribute : function(name){\r\n\t\treturn this.getAttributeNode(name)!=null;\r\n\t},\r\n\tgetAttribute : function(name){\r\n\t\tvar attr = this.getAttributeNode(name);\r\n\t\treturn attr && attr.value || '';\r\n\t},\r\n\tgetAttributeNode : function(name){\r\n\t\treturn this.attributes.getNamedItem(name);\r\n\t},\r\n\tsetAttribute : function(name, value){\r\n\t\tvar attr = this.ownerDocument.createAttribute(name);\r\n\t\tattr.value = attr.nodeValue = \"\" + value;\r\n\t\tthis.setAttributeNode(attr)\r\n\t},\r\n\tremoveAttribute : function(name){\r\n\t\tvar attr = this.getAttributeNode(name)\r\n\t\tattr && this.removeAttributeNode(attr);\r\n\t},\r\n\t\r\n\t//four real opeartion method\r\n\tappendChild:function(newChild){\r\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\r\n\t\t\treturn this.insertBefore(newChild,null);\r\n\t\t}else{\r\n\t\t\treturn _appendSingleChild(this,newChild);\r\n\t\t}\r\n\t},\r\n\tsetAttributeNode : function(newAttr){\r\n\t\treturn this.attributes.setNamedItem(newAttr);\r\n\t},\r\n\tsetAttributeNodeNS : function(newAttr){\r\n\t\treturn this.attributes.setNamedItemNS(newAttr);\r\n\t},\r\n\tremoveAttributeNode : function(oldAttr){\r\n\t\t//console.log(this == oldAttr.ownerElement)\r\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\r\n\t},\r\n\t//get real attribute name,and remove it by removeAttributeNode\r\n\tremoveAttributeNS : function(namespaceURI, localName){\r\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\r\n\t\told && this.removeAttributeNode(old);\r\n\t},\r\n\t\r\n\thasAttributeNS : function(namespaceURI, localName){\r\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\r\n\t},\r\n\tgetAttributeNS : function(namespaceURI, localName){\r\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\r\n\t\treturn attr && attr.value || '';\r\n\t},\r\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\r\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\r\n\t\tattr.value = attr.nodeValue = \"\" + value;\r\n\t\tthis.setAttributeNode(attr)\r\n\t},\r\n\tgetAttributeNodeNS : function(namespaceURI, localName){\r\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\r\n\t},\r\n\t\r\n\tgetElementsByTagName : function(tagName){\r\n\t\treturn new LiveNodeList(this,function(base){\r\n\t\t\tvar ls = [];\r\n\t\t\t_visitNode(base,function(node){\r\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\r\n\t\t\t\t\tls.push(node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ls;\r\n\t\t});\r\n\t},\r\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\r\n\t\treturn new LiveNodeList(this,function(base){\r\n\t\t\tvar ls = [];\r\n\t\t\t_visitNode(base,function(node){\r\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){\r\n\t\t\t\t\tls.push(node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ls;\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n};\r\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\r\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\r\n\r\n\r\n_extends(Element,Node);\r\nfunction Attr() {\r\n};\r\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\r\n_extends(Attr,Node);\r\n\r\n\r\nfunction CharacterData() {\r\n};\r\nCharacterData.prototype = {\r\n\tdata : '',\r\n\tsubstringData : function(offset, count) {\r\n\t\treturn this.data.substring(offset, offset+count);\r\n\t},\r\n\tappendData: function(text) {\r\n\t\ttext = this.data+text;\r\n\t\tthis.nodeValue = this.data = text;\r\n\t\tthis.length = text.length;\r\n\t},\r\n\tinsertData: function(offset,text) {\r\n\t\tthis.replaceData(offset,0,text);\r\n\t\r\n\t},\r\n\tappendChild:function(newChild){\r\n\t\tthrow new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])\r\n\t},\r\n\tdeleteData: function(offset, count) {\r\n\t\tthis.replaceData(offset,count,\"\");\r\n\t},\r\n\treplaceData: function(offset, count, text) {\r\n\t\tvar start = this.data.substring(0,offset);\r\n\t\tvar end = this.data.substring(offset+count);\r\n\t\ttext = start + text + end;\r\n\t\tthis.nodeValue = this.data = text;\r\n\t\tthis.length = text.length;\r\n\t}\r\n}\r\n_extends(CharacterData,Node);\r\nfunction Text() {\r\n};\r\nText.prototype = {\r\n\tnodeName : \"#text\",\r\n\tnodeType : TEXT_NODE,\r\n\tsplitText : function(offset) {\r\n\t\tvar text = this.data;\r\n\t\tvar newText = text.substring(offset);\r\n\t\ttext = text.substring(0, offset);\r\n\t\tthis.data = this.nodeValue = text;\r\n\t\tthis.length = text.length;\r\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\r\n\t\tif(this.parentNode){\r\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\r\n\t\t}\r\n\t\treturn newNode;\r\n\t}\r\n}\r\n_extends(Text,CharacterData);\r\nfunction Comment() {\r\n};\r\nComment.prototype = {\r\n\tnodeName : \"#comment\",\r\n\tnodeType : COMMENT_NODE\r\n}\r\n_extends(Comment,CharacterData);\r\n\r\nfunction CDATASection() {\r\n};\r\nCDATASection.prototype = {\r\n\tnodeName : \"#cdata-section\",\r\n\tnodeType : CDATA_SECTION_NODE\r\n}\r\n_extends(CDATASection,CharacterData);\r\n\r\n\r\nfunction DocumentType() {\r\n};\r\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\r\n_extends(DocumentType,Node);\r\n\r\nfunction Notation() {\r\n};\r\nNotation.prototype.nodeType = NOTATION_NODE;\r\n_extends(Notation,Node);\r\n\r\nfunction Entity() {\r\n};\r\nEntity.prototype.nodeType = ENTITY_NODE;\r\n_extends(Entity,Node);\r\n\r\nfunction EntityReference() {\r\n};\r\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\r\n_extends(EntityReference,Node);\r\n\r\nfunction DocumentFragment() {\r\n};\r\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\r\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\r\n_extends(DocumentFragment,Node);\r\n\r\n\r\nfunction ProcessingInstruction() {\r\n}\r\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\r\n_extends(ProcessingInstruction,Node);\r\nfunction XMLSerializer(){}\r\nXMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){\r\n\treturn nodeSerializeToString.call(node,isHtml,nodeFilter);\r\n}\r\nNode.prototype.toString = nodeSerializeToString;\r\nfunction nodeSerializeToString(isHtml,nodeFilter){\r\n\tvar buf = [];\r\n\tvar refNode = this.nodeType == 9 && this.documentElement || this;\r\n\tvar prefix = refNode.prefix;\r\n\tvar uri = refNode.namespaceURI;\r\n\t\r\n\tif(uri && prefix == null){\r\n\t\t//console.log(prefix)\r\n\t\tvar prefix = refNode.lookupPrefix(uri);\r\n\t\tif(prefix == null){\r\n\t\t\t//isHTML = true;\r\n\t\t\tvar visibleNamespaces=[\r\n\t\t\t{namespace:uri,prefix:null}\r\n\t\t\t//{namespace:uri,prefix:''}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\tserializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);\r\n\t//console.log('###',this.nodeType,uri,prefix,buf.join(''))\r\n\treturn buf.join('');\r\n}\r\n\r\nfunction needNamespaceDefine(node, isHTML, visibleNamespaces) {\r\n\tvar prefix = node.prefix || '';\r\n\tvar uri = node.namespaceURI;\r\n\t// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,\r\n\t// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :\r\n\t// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.\r\n\t// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)\r\n\t// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :\r\n\t// > [...] Furthermore, the attribute value [...] must not be an empty string.\r\n\t// so serializing empty namespace value like xmlns:ds=\"\" would produce an invalid XML document.\r\n\tif (!uri) {\r\n\t\treturn false;\r\n\t}\r\n\tif (prefix === \"xml\" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tvar i = visibleNamespaces.length \r\n\twhile (i--) {\r\n\t\tvar ns = visibleNamespaces[i];\r\n\t\t// get namespace prefix\r\n\t\tif (ns.prefix === prefix) {\r\n\t\t\treturn ns.namespace !== uri;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n/**\r\n * Well-formed constraint: No < in Attribute Values\r\n * The replacement text of any entity referred to directly or indirectly in an attribute value must not contain a <.\r\n * @see https://www.w3.org/TR/xml/#CleanAttrVals\r\n * @see https://www.w3.org/TR/xml/#NT-AttValue\r\n */\r\nfunction addSerializedAttribute(buf, qualifiedName, value) {\r\n\tbuf.push(' ', qualifiedName, '=\"', value.replace(/[<&\"]/g,_xmlEncoder), '\"')\r\n}\r\n\r\nfunction serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\r\n\tif (!visibleNamespaces) {\r\n\t\tvisibleNamespaces = [];\r\n\t}\r\n\r\n\tif(nodeFilter){\r\n\t\tnode = nodeFilter(node);\r\n\t\tif(node){\r\n\t\t\tif(typeof node == 'string'){\r\n\t\t\t\tbuf.push(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//buf.sort.apply(attrs, attributeSorter);\r\n\t}\r\n\r\n\tswitch(node.nodeType){\r\n\tcase ELEMENT_NODE:\r\n\t\tvar attrs = node.attributes;\r\n\t\tvar len = attrs.length;\r\n\t\tvar child = node.firstChild;\r\n\t\tvar nodeName = node.tagName;\r\n\t\t\r\n\t\tisHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML\r\n\r\n\t\tvar prefixedNodeName = nodeName\r\n\t\tif (!isHTML && !node.prefix && node.namespaceURI) {\r\n\t\t\tvar defaultNS\r\n\t\t\t// lookup current default ns from `xmlns` attribute\r\n\t\t\tfor (var ai = 0; ai < attrs.length; ai++) {\r\n\t\t\t\tif (attrs.item(ai).name === 'xmlns') {\r\n\t\t\t\t\tdefaultNS = attrs.item(ai).value\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!defaultNS) {\r\n\t\t\t\t// lookup current default ns in visibleNamespaces\r\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\r\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\r\n\t\t\t\t\tif (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {\r\n\t\t\t\t\t\tdefaultNS = namespace.namespace\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (defaultNS !== node.namespaceURI) {\r\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\r\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\r\n\t\t\t\t\tif (namespace.namespace === node.namespaceURI) {\r\n\t\t\t\t\t\tif (namespace.prefix) {\r\n\t\t\t\t\t\t\tprefixedNodeName = namespace.prefix + ':' + nodeName\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbuf.push('<', prefixedNodeName);\r\n\r\n\t\tfor(var i=0;i<len;i++){\r\n\t\t\t// add namespaces for attributes\r\n\t\t\tvar attr = attrs.item(i);\r\n\t\t\tif (attr.prefix == 'xmlns') {\r\n\t\t\t\tvisibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });\r\n\t\t\t}else if(attr.nodeName == 'xmlns'){\r\n\t\t\t\tvisibleNamespaces.push({ prefix: '', namespace: attr.value });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(var i=0;i<len;i++){\r\n\t\t\tvar attr = attrs.item(i);\r\n\t\t\tif (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {\r\n\t\t\t\tvar prefix = attr.prefix||'';\r\n\t\t\t\tvar uri = attr.namespaceURI;\r\n\t\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\r\n\t\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\r\n\t\t\t}\r\n\t\t\tserializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);\r\n\t\t}\r\n\r\n\t\t// add namespace for current node\t\t\r\n\t\tif (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {\r\n\t\t\tvar prefix = node.prefix||'';\r\n\t\t\tvar uri = node.namespaceURI;\r\n\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\r\n\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\r\n\t\t}\r\n\t\t\r\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\r\n\t\t\tbuf.push('>');\r\n\t\t\t//if is cdata child node\r\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\r\n\t\t\t\twhile(child){\r\n\t\t\t\t\tif(child.data){\r\n\t\t\t\t\t\tbuf.push(child.data);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchild = child.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}else\r\n\t\t\t{\r\n\t\t\t\twhile(child){\r\n\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\r\n\t\t\t\t\tchild = child.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbuf.push('</',prefixedNodeName,'>');\r\n\t\t}else{\r\n\t\t\tbuf.push('/>');\r\n\t\t}\r\n\t\t// remove added visible namespaces\r\n\t\t//visibleNamespaces.length = startVisibleNamespaces;\r\n\t\treturn;\r\n\tcase DOCUMENT_NODE:\r\n\tcase DOCUMENT_FRAGMENT_NODE:\r\n\t\tvar child = node.firstChild;\r\n\t\twhile(child){\r\n\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\r\n\t\t\tchild = child.nextSibling;\r\n\t\t}\r\n\t\treturn;\r\n\tcase ATTRIBUTE_NODE:\r\n\t\treturn addSerializedAttribute(buf, node.name, node.value);\r\n\tcase TEXT_NODE:\r\n\t\t/**\r\n\t\t * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,\r\n\t\t * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.\r\n\t\t * If they are needed elsewhere, they must be escaped using either numeric character references or the strings\r\n\t\t * `&amp;` and `&lt;` respectively.\r\n\t\t * The right angle bracket (>) may be represented using the string \" &gt; \", and must, for compatibility,\r\n\t\t * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,\r\n\t\t * when that string is not marking the end of a CDATA section.\r\n\t\t *\r\n\t\t * In the content of elements, character data is any string of characters\r\n\t\t * which does not contain the start-delimiter of any markup\r\n\t\t * and does not include the CDATA-section-close delimiter, `]]>`.\r\n\t\t *\r\n\t\t * @see https://www.w3.org/TR/xml/#NT-CharData\r\n\t\t */\r\n\t\treturn buf.push(node.data\r\n\t\t\t.replace(/[<&]/g,_xmlEncoder)\r\n\t\t\t.replace(/]]>/g, ']]&gt;')\r\n\t\t);\r\n\tcase CDATA_SECTION_NODE:\r\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\r\n\tcase COMMENT_NODE:\r\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\r\n\tcase DOCUMENT_TYPE_NODE:\r\n\t\tvar pubid = node.publicId;\r\n\t\tvar sysid = node.systemId;\r\n\t\tbuf.push('<!DOCTYPE ',node.name);\r\n\t\tif(pubid){\r\n\t\t\tbuf.push(' PUBLIC ', pubid);\r\n\t\t\tif (sysid && sysid!='.') {\r\n\t\t\t\tbuf.push(' ', sysid);\r\n\t\t\t}\r\n\t\t\tbuf.push('>');\r\n\t\t}else if(sysid && sysid!='.'){\r\n\t\t\tbuf.push(' SYSTEM ', sysid, '>');\r\n\t\t}else{\r\n\t\t\tvar sub = node.internalSubset;\r\n\t\t\tif(sub){\r\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\r\n\t\t\t}\r\n\t\t\tbuf.push(\">\");\r\n\t\t}\r\n\t\treturn;\r\n\tcase PROCESSING_INSTRUCTION_NODE:\r\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\r\n\tcase ENTITY_REFERENCE_NODE:\r\n\t\treturn buf.push( '&',node.nodeName,';');\r\n\t//case ENTITY_NODE:\r\n\t//case NOTATION_NODE:\r\n\tdefault:\r\n\t\tbuf.push('??',node.nodeName);\r\n\t}\r\n}\r\nfunction importNode(doc,node,deep){\r\n\tvar node2;\r\n\tswitch (node.nodeType) {\r\n\tcase ELEMENT_NODE:\r\n\t\tnode2 = node.cloneNode(false);\r\n\t\tnode2.ownerDocument = doc;\r\n\t\t//var attrs = node2.attributes;\r\n\t\t//var len = attrs.length;\r\n\t\t//for(var i=0;i<len;i++){\r\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\r\n\t\t//}\r\n\tcase DOCUMENT_FRAGMENT_NODE:\r\n\t\tbreak;\r\n\tcase ATTRIBUTE_NODE:\r\n\t\tdeep = true;\r\n\t\tbreak;\r\n\t//case ENTITY_REFERENCE_NODE:\r\n\t//case PROCESSING_INSTRUCTION_NODE:\r\n\t////case TEXT_NODE:\r\n\t//case CDATA_SECTION_NODE:\r\n\t//case COMMENT_NODE:\r\n\t//\tdeep = false;\r\n\t//\tbreak;\r\n\t//case DOCUMENT_NODE:\r\n\t//case DOCUMENT_TYPE_NODE:\r\n\t//cannot be imported.\r\n\t//case ENTITY_NODE:\r\n\t//case NOTATION_NODEï¼š\r\n\t//can not hit in level3\r\n\t//default:throw e;\r\n\t}\r\n\tif(!node2){\r\n\t\tnode2 = node.cloneNode(false);//false\r\n\t}\r\n\tnode2.ownerDocument = doc;\r\n\tnode2.parentNode = null;\r\n\tif(deep){\r\n\t\tvar child = node.firstChild;\r\n\t\twhile(child){\r\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\r\n\t\t\tchild = child.nextSibling;\r\n\t\t}\r\n\t}\r\n\treturn node2;\r\n}\r\n//\r\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\r\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\r\nfunction cloneNode(doc,node,deep){\r\n\tvar node2 = new node.constructor();\r\n\tfor(var n in node){\r\n\t\tvar v = node[n];\r\n\t\tif(typeof v != 'object' ){\r\n\t\t\tif(v != node2[n]){\r\n\t\t\t\tnode2[n] = v;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(node.childNodes){\r\n\t\tnode2.childNodes = new NodeList();\r\n\t}\r\n\tnode2.ownerDocument = doc;\r\n\tswitch (node2.nodeType) {\r\n\tcase ELEMENT_NODE:\r\n\t\tvar attrs\t= node.attributes;\r\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\r\n\t\tvar len = attrs.length\r\n\t\tattrs2._ownerElement = node2;\r\n\t\tfor(var i=0;i<len;i++){\r\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\r\n\t\t}\r\n\t\tbreak;;\r\n\tcase ATTRIBUTE_NODE:\r\n\t\tdeep = true;\r\n\t}\r\n\tif(deep){\r\n\t\tvar child = node.firstChild;\r\n\t\twhile(child){\r\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\r\n\t\t\tchild = child.nextSibling;\r\n\t\t}\r\n\t}\r\n\treturn node2;\r\n}\r\n\r\nfunction __set__(object,key,value){\r\n\tobject[key] = value\r\n}\r\n//do dynamic\r\ntry{\r\n\tif(Object.defineProperty){\r\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\r\n\t\t\tget:function(){\r\n\t\t\t\t_updateLiveList(this);\r\n\t\t\t\treturn this.$$length;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(Node.prototype,'textContent',{\r\n\t\t\tget:function(){\r\n\t\t\t\treturn getTextContent(this);\r\n\t\t\t},\r\n\r\n\t\t\tset:function(data){\r\n\t\t\t\tswitch(this.nodeType){\r\n\t\t\t\tcase ELEMENT_NODE:\r\n\t\t\t\tcase DOCUMENT_FRAGMENT_NODE:\r\n\t\t\t\t\twhile(this.firstChild){\r\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(data || String(data)){\r\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.data = data;\r\n\t\t\t\t\tthis.value = data;\r\n\t\t\t\t\tthis.nodeValue = data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t\tfunction getTextContent(node){\r\n\t\t\tswitch(node.nodeType){\r\n\t\t\tcase ELEMENT_NODE:\r\n\t\t\tcase DOCUMENT_FRAGMENT_NODE:\r\n\t\t\t\tvar buf = [];\r\n\t\t\t\tnode = node.firstChild;\r\n\t\t\t\twhile(node){\r\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\r\n\t\t\t\t\t\tbuf.push(getTextContent(node));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t\treturn buf.join('');\r\n\t\t\tdefault:\r\n\t\t\t\treturn node.nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t__set__ = function(object,key,value){\r\n\t\t\t//console.log(value)\r\n\t\t\tobject['$$'+key] = value\r\n\t\t}\r\n\t}\r\n}catch(e){//ie8\r\n}\r\n\r\n//if(typeof require == 'function'){\r\n\texports.DocumentType = DocumentType;\r\n\texports.DOMException = DOMException;\r\n\texports.DOMImplementation = DOMImplementation;\r\n\texports.Element = Element;\r\n\texports.Node = Node;\r\n\texports.NodeList = NodeList;\r\n\texports.XMLSerializer = XMLSerializer;\r\n//}\r\n"]},"metadata":{},"sourceType":"script"}