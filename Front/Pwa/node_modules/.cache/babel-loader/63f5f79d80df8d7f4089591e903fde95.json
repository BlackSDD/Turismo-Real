{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.readCollation = readCollation;\nexports.default = void 0;\n\nvar _collation = require(\"./collation\");\n\nvar _dataType = require(\"./data-type\");\n\nvar _sprintfJs = require(\"sprintf-js\");\n\nfunction readCollation(parser, callback) {\n  // s2.2.5.1.2\n  parser.readBuffer(5, collationData => {\n    let lcid = (collationData[2] & 0x0F) << 16;\n    lcid |= collationData[1] << 8;\n    lcid |= collationData[0]; // This may not be extracting the correct nibbles in the correct order.\n\n    let flags = collationData[3] >> 4;\n    flags |= collationData[2] & 0xF0; // This may not be extracting the correct nibble.\n\n    const version = collationData[3] & 0x0F;\n    const sortId = collationData[4];\n    const codepage = _collation.codepageBySortId[sortId] || _collation.codepageByLcid[lcid] || 'CP1252';\n    callback({\n      lcid,\n      flags,\n      version,\n      sortId,\n      codepage\n    });\n  });\n}\n\nfunction readSchema(parser, callback) {\n  // s2.2.5.5.3\n  parser.readUInt8(schemaPresent => {\n    if (schemaPresent === 0x01) {\n      parser.readBVarChar(dbname => {\n        parser.readBVarChar(owningSchema => {\n          parser.readUsVarChar(xmlSchemaCollection => {\n            callback({\n              dbname: dbname,\n              owningSchema: owningSchema,\n              xmlSchemaCollection: xmlSchemaCollection\n            });\n          });\n        });\n      });\n    } else {\n      callback(undefined);\n    }\n  });\n}\n\nfunction readUDTInfo(parser, callback) {\n  parser.readUInt16LE(maxByteSize => {\n    parser.readBVarChar(dbname => {\n      parser.readBVarChar(owningSchema => {\n        parser.readBVarChar(typeName => {\n          parser.readUsVarChar(assemblyName => {\n            callback({\n              maxByteSize: maxByteSize,\n              dbname: dbname,\n              owningSchema: owningSchema,\n              typeName: typeName,\n              assemblyName: assemblyName\n            });\n          });\n        });\n      });\n    });\n  });\n}\n\nfunction metadataParse(parser, options, callback) {\n  (options.tdsVersion < '7_2' ? parser.readUInt16LE : parser.readUInt32LE).call(parser, userType => {\n    parser.readUInt16LE(flags => {\n      parser.readUInt8(typeNumber => {\n        const type = _dataType.TYPE[typeNumber];\n\n        if (!type) {\n          throw new Error((0, _sprintfJs.sprintf)('Unrecognised data type 0x%02X', typeNumber));\n        }\n\n        switch (type.name) {\n          case 'Null':\n          case 'TinyInt':\n          case 'SmallInt':\n          case 'Int':\n          case 'BigInt':\n          case 'Real':\n          case 'Float':\n          case 'SmallMoney':\n          case 'Money':\n          case 'Bit':\n          case 'SmallDateTime':\n          case 'DateTime':\n          case 'Date':\n            return callback({\n              userType: userType,\n              flags: flags,\n              type: type,\n              collation: undefined,\n              precision: undefined,\n              scale: undefined,\n              dataLength: undefined,\n              schema: undefined,\n              udtInfo: undefined\n            });\n\n          case 'IntN':\n          case 'FloatN':\n          case 'MoneyN':\n          case 'BitN':\n          case 'UniqueIdentifier':\n          case 'DateTimeN':\n            return parser.readUInt8(dataLength => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: dataLength,\n                schema: undefined,\n                udtInfo: undefined\n              });\n            });\n\n          case 'Variant':\n            return parser.readUInt32LE(dataLength => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: dataLength,\n                schema: undefined,\n                udtInfo: undefined\n              });\n            });\n\n          case 'VarChar':\n          case 'Char':\n          case 'NVarChar':\n          case 'NChar':\n            return parser.readUInt16LE(dataLength => {\n              readCollation(parser, collation => {\n                callback({\n                  userType: userType,\n                  flags: flags,\n                  type: type,\n                  collation: collation,\n                  precision: undefined,\n                  scale: undefined,\n                  dataLength: dataLength,\n                  schema: undefined,\n                  udtInfo: undefined\n                });\n              });\n            });\n\n          case 'Text':\n          case 'NText':\n            return parser.readUInt32LE(dataLength => {\n              readCollation(parser, collation => {\n                callback({\n                  userType: userType,\n                  flags: flags,\n                  type: type,\n                  collation: collation,\n                  precision: undefined,\n                  scale: undefined,\n                  dataLength: dataLength,\n                  schema: undefined,\n                  udtInfo: undefined\n                });\n              });\n            });\n\n          case 'VarBinary':\n          case 'Binary':\n            return parser.readUInt16LE(dataLength => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: dataLength,\n                schema: undefined,\n                udtInfo: undefined\n              });\n            });\n\n          case 'Image':\n            return parser.readUInt32LE(dataLength => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: dataLength,\n                schema: undefined,\n                udtInfo: undefined\n              });\n            });\n\n          case 'Xml':\n            return readSchema(parser, schema => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: undefined,\n                schema: schema,\n                udtInfo: undefined\n              });\n            });\n\n          case 'Time':\n          case 'DateTime2':\n          case 'DateTimeOffset':\n            return parser.readUInt8(scale => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: scale,\n                dataLength: undefined,\n                schema: undefined,\n                udtInfo: undefined\n              });\n            });\n\n          case 'NumericN':\n          case 'DecimalN':\n            return parser.readUInt8(dataLength => {\n              parser.readUInt8(precision => {\n                parser.readUInt8(scale => {\n                  callback({\n                    userType: userType,\n                    flags: flags,\n                    type: type,\n                    collation: undefined,\n                    precision: precision,\n                    scale: scale,\n                    dataLength: dataLength,\n                    schema: undefined,\n                    udtInfo: undefined\n                  });\n                });\n              });\n            });\n\n          case 'UDT':\n            return readUDTInfo(parser, udtInfo => {\n              callback({\n                userType: userType,\n                flags: flags,\n                type: type,\n                collation: undefined,\n                precision: undefined,\n                scale: undefined,\n                dataLength: undefined,\n                schema: undefined,\n                udtInfo: udtInfo\n              });\n            });\n\n          default:\n            throw new Error((0, _sprintfJs.sprintf)('Unrecognised type %s', type.name));\n        }\n      });\n    });\n  });\n}\n\nvar _default = metadataParse;\nexports.default = _default;\nmodule.exports = metadataParse;\nmodule.exports.readCollation = readCollation;","map":{"version":3,"sources":["B:/Duoc/Portafolio_de_titulo/Git/Turismo-Real/Front/Pwa/node_modules/mssql/node_modules/tedious/lib/metadata-parser.js"],"names":["Object","defineProperty","exports","value","readCollation","default","_collation","require","_dataType","_sprintfJs","parser","callback","readBuffer","collationData","lcid","flags","version","sortId","codepage","codepageBySortId","codepageByLcid","readSchema","readUInt8","schemaPresent","readBVarChar","dbname","owningSchema","readUsVarChar","xmlSchemaCollection","undefined","readUDTInfo","readUInt16LE","maxByteSize","typeName","assemblyName","metadataParse","options","tdsVersion","readUInt32LE","call","userType","typeNumber","type","TYPE","Error","sprintf","name","collation","precision","scale","dataLength","schema","udtInfo","_default","module"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.readCollation = readCollation;\r\nexports.default = void 0;\r\n\r\nvar _collation = require(\"./collation\");\r\n\r\nvar _dataType = require(\"./data-type\");\r\n\r\nvar _sprintfJs = require(\"sprintf-js\");\r\n\r\nfunction readCollation(parser, callback) {\r\n  // s2.2.5.1.2\r\n  parser.readBuffer(5, collationData => {\r\n    let lcid = (collationData[2] & 0x0F) << 16;\r\n    lcid |= collationData[1] << 8;\r\n    lcid |= collationData[0]; // This may not be extracting the correct nibbles in the correct order.\r\n\r\n    let flags = collationData[3] >> 4;\r\n    flags |= collationData[2] & 0xF0; // This may not be extracting the correct nibble.\r\n\r\n    const version = collationData[3] & 0x0F;\r\n    const sortId = collationData[4];\r\n    const codepage = _collation.codepageBySortId[sortId] || _collation.codepageByLcid[lcid] || 'CP1252';\r\n    callback({\r\n      lcid,\r\n      flags,\r\n      version,\r\n      sortId,\r\n      codepage\r\n    });\r\n  });\r\n}\r\n\r\nfunction readSchema(parser, callback) {\r\n  // s2.2.5.5.3\r\n  parser.readUInt8(schemaPresent => {\r\n    if (schemaPresent === 0x01) {\r\n      parser.readBVarChar(dbname => {\r\n        parser.readBVarChar(owningSchema => {\r\n          parser.readUsVarChar(xmlSchemaCollection => {\r\n            callback({\r\n              dbname: dbname,\r\n              owningSchema: owningSchema,\r\n              xmlSchemaCollection: xmlSchemaCollection\r\n            });\r\n          });\r\n        });\r\n      });\r\n    } else {\r\n      callback(undefined);\r\n    }\r\n  });\r\n}\r\n\r\nfunction readUDTInfo(parser, callback) {\r\n  parser.readUInt16LE(maxByteSize => {\r\n    parser.readBVarChar(dbname => {\r\n      parser.readBVarChar(owningSchema => {\r\n        parser.readBVarChar(typeName => {\r\n          parser.readUsVarChar(assemblyName => {\r\n            callback({\r\n              maxByteSize: maxByteSize,\r\n              dbname: dbname,\r\n              owningSchema: owningSchema,\r\n              typeName: typeName,\r\n              assemblyName: assemblyName\r\n            });\r\n          });\r\n        });\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nfunction metadataParse(parser, options, callback) {\r\n  (options.tdsVersion < '7_2' ? parser.readUInt16LE : parser.readUInt32LE).call(parser, userType => {\r\n    parser.readUInt16LE(flags => {\r\n      parser.readUInt8(typeNumber => {\r\n        const type = _dataType.TYPE[typeNumber];\r\n\r\n        if (!type) {\r\n          throw new Error((0, _sprintfJs.sprintf)('Unrecognised data type 0x%02X', typeNumber));\r\n        }\r\n\r\n        switch (type.name) {\r\n          case 'Null':\r\n          case 'TinyInt':\r\n          case 'SmallInt':\r\n          case 'Int':\r\n          case 'BigInt':\r\n          case 'Real':\r\n          case 'Float':\r\n          case 'SmallMoney':\r\n          case 'Money':\r\n          case 'Bit':\r\n          case 'SmallDateTime':\r\n          case 'DateTime':\r\n          case 'Date':\r\n            return callback({\r\n              userType: userType,\r\n              flags: flags,\r\n              type: type,\r\n              collation: undefined,\r\n              precision: undefined,\r\n              scale: undefined,\r\n              dataLength: undefined,\r\n              schema: undefined,\r\n              udtInfo: undefined\r\n            });\r\n\r\n          case 'IntN':\r\n          case 'FloatN':\r\n          case 'MoneyN':\r\n          case 'BitN':\r\n          case 'UniqueIdentifier':\r\n          case 'DateTimeN':\r\n            return parser.readUInt8(dataLength => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: dataLength,\r\n                schema: undefined,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'Variant':\r\n            return parser.readUInt32LE(dataLength => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: dataLength,\r\n                schema: undefined,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'VarChar':\r\n          case 'Char':\r\n          case 'NVarChar':\r\n          case 'NChar':\r\n            return parser.readUInt16LE(dataLength => {\r\n              readCollation(parser, collation => {\r\n                callback({\r\n                  userType: userType,\r\n                  flags: flags,\r\n                  type: type,\r\n                  collation: collation,\r\n                  precision: undefined,\r\n                  scale: undefined,\r\n                  dataLength: dataLength,\r\n                  schema: undefined,\r\n                  udtInfo: undefined\r\n                });\r\n              });\r\n            });\r\n\r\n          case 'Text':\r\n          case 'NText':\r\n            return parser.readUInt32LE(dataLength => {\r\n              readCollation(parser, collation => {\r\n                callback({\r\n                  userType: userType,\r\n                  flags: flags,\r\n                  type: type,\r\n                  collation: collation,\r\n                  precision: undefined,\r\n                  scale: undefined,\r\n                  dataLength: dataLength,\r\n                  schema: undefined,\r\n                  udtInfo: undefined\r\n                });\r\n              });\r\n            });\r\n\r\n          case 'VarBinary':\r\n          case 'Binary':\r\n            return parser.readUInt16LE(dataLength => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: dataLength,\r\n                schema: undefined,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'Image':\r\n            return parser.readUInt32LE(dataLength => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: dataLength,\r\n                schema: undefined,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'Xml':\r\n            return readSchema(parser, schema => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: undefined,\r\n                schema: schema,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'Time':\r\n          case 'DateTime2':\r\n          case 'DateTimeOffset':\r\n            return parser.readUInt8(scale => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: scale,\r\n                dataLength: undefined,\r\n                schema: undefined,\r\n                udtInfo: undefined\r\n              });\r\n            });\r\n\r\n          case 'NumericN':\r\n          case 'DecimalN':\r\n            return parser.readUInt8(dataLength => {\r\n              parser.readUInt8(precision => {\r\n                parser.readUInt8(scale => {\r\n                  callback({\r\n                    userType: userType,\r\n                    flags: flags,\r\n                    type: type,\r\n                    collation: undefined,\r\n                    precision: precision,\r\n                    scale: scale,\r\n                    dataLength: dataLength,\r\n                    schema: undefined,\r\n                    udtInfo: undefined\r\n                  });\r\n                });\r\n              });\r\n            });\r\n\r\n          case 'UDT':\r\n            return readUDTInfo(parser, udtInfo => {\r\n              callback({\r\n                userType: userType,\r\n                flags: flags,\r\n                type: type,\r\n                collation: undefined,\r\n                precision: undefined,\r\n                scale: undefined,\r\n                dataLength: undefined,\r\n                schema: undefined,\r\n                udtInfo: udtInfo\r\n              });\r\n            });\r\n\r\n          default:\r\n            throw new Error((0, _sprintfJs.sprintf)('Unrecognised type %s', type.name));\r\n        }\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nvar _default = metadataParse;\r\nexports.default = _default;\r\nmodule.exports = metadataParse;\r\nmodule.exports.readCollation = readCollation;"]},"metadata":{},"sourceType":"script"}