{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _writableTrackingBuffer = _interopRequireDefault(require(\"./tracking-buffer/writable-tracking-buffer\"));\n\nvar crypto = _interopRequireWildcard(require(\"crypto\"));\n\nvar _jsbi = _interopRequireDefault(require(\"jsbi\"));\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar NTLMResponsePayload = /*#__PURE__*/function () {\n  function NTLMResponsePayload(loginData) {\n    _classCallCheck(this, NTLMResponsePayload);\n\n    this.data = void 0;\n    this.data = this.createResponse(loginData);\n  }\n\n  _createClass(NTLMResponsePayload, [{\n    key: \"toString\",\n    value: function toString() {\n      var indent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      return indent + 'NTLM Auth';\n    }\n  }, {\n    key: \"createResponse\",\n    value: function createResponse(challenge) {\n      var client_nonce = this.createClientNonce();\n      var lmv2len = 24;\n      var ntlmv2len = 16;\n      var domain = challenge.domain;\n      var username = challenge.userName;\n      var password = challenge.password;\n      var ntlmData = challenge.ntlmpacket;\n      var server_data = ntlmData.target;\n      var server_nonce = ntlmData.nonce;\n      var bufferLength = 64 + domain.length * 2 + username.length * 2 + lmv2len + ntlmv2len + 8 + 8 + 8 + 4 + server_data.length + 4;\n      var data = new _writableTrackingBuffer.default(bufferLength);\n      data.position = 0;\n      data.writeString(\"NTLMSSP\\0\", 'utf8');\n      data.writeUInt32LE(0x03);\n      var baseIdx = 64;\n      var dnIdx = baseIdx;\n      var unIdx = dnIdx + domain.length * 2;\n      var l2Idx = unIdx + username.length * 2;\n      var ntIdx = l2Idx + lmv2len;\n      data.writeUInt16LE(lmv2len);\n      data.writeUInt16LE(lmv2len);\n      data.writeUInt32LE(l2Idx);\n      data.writeUInt16LE(ntlmv2len);\n      data.writeUInt16LE(ntlmv2len);\n      data.writeUInt32LE(ntIdx);\n      data.writeUInt16LE(domain.length * 2);\n      data.writeUInt16LE(domain.length * 2);\n      data.writeUInt32LE(dnIdx);\n      data.writeUInt16LE(username.length * 2);\n      data.writeUInt16LE(username.length * 2);\n      data.writeUInt32LE(unIdx);\n      data.writeUInt16LE(0);\n      data.writeUInt16LE(0);\n      data.writeUInt32LE(baseIdx);\n      data.writeUInt16LE(0);\n      data.writeUInt16LE(0);\n      data.writeUInt32LE(baseIdx);\n      data.writeUInt16LE(0x8201);\n      data.writeUInt16LE(0x08);\n      data.writeString(domain, 'ucs2');\n      data.writeString(username, 'ucs2');\n      var lmv2Data = this.lmv2Response(domain, username, password, server_nonce, client_nonce);\n      data.copyFrom(lmv2Data);\n      var genTime = new Date().getTime();\n      var ntlmDataBuffer = this.ntlmv2Response(domain, username, password, server_nonce, server_data, client_nonce, genTime);\n      data.copyFrom(ntlmDataBuffer);\n      data.writeUInt32LE(0x0101);\n      data.writeUInt32LE(0x0000);\n      var timestamp = this.createTimestamp(genTime);\n      data.copyFrom(timestamp);\n      data.copyFrom(client_nonce);\n      data.writeUInt32LE(0x0000);\n      data.copyFrom(server_data);\n      data.writeUInt32LE(0x0000);\n      return data.data;\n    }\n  }, {\n    key: \"createClientNonce\",\n    value: function createClientNonce() {\n      var client_nonce = Buffer.alloc(8, 0);\n      var nidx = 0;\n\n      while (nidx < 8) {\n        client_nonce.writeUInt8(Math.ceil(Math.random() * 255), nidx);\n        nidx++;\n      }\n\n      return client_nonce;\n    }\n  }, {\n    key: \"ntlmv2Response\",\n    value: function ntlmv2Response(domain, user, password, serverNonce, targetInfo, clientNonce, mytime) {\n      var timestamp = this.createTimestamp(mytime);\n      var hash = this.ntv2Hash(domain, user, password);\n      var dataLength = 40 + targetInfo.length;\n      var data = Buffer.alloc(dataLength, 0);\n      serverNonce.copy(data, 0, 0, 8);\n      data.writeUInt32LE(0x101, 8);\n      data.writeUInt32LE(0x0, 12);\n      timestamp.copy(data, 16, 0, 8);\n      clientNonce.copy(data, 24, 0, 8);\n      data.writeUInt32LE(0x0, 32);\n      targetInfo.copy(data, 36, 0, targetInfo.length);\n      data.writeUInt32LE(0x0, 36 + targetInfo.length);\n      return this.hmacMD5(data, hash);\n    }\n  }, {\n    key: \"createTimestamp\",\n    value: function createTimestamp(time) {\n      var tenthsOfAMicrosecond = _jsbi.default.multiply(_jsbi.default.add(_jsbi.default.BigInt(time), _jsbi.default.BigInt(11644473600)), _jsbi.default.BigInt(10000000));\n\n      var lo = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(tenthsOfAMicrosecond, _jsbi.default.BigInt(0xffffffff)));\n\n      var hi = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(_jsbi.default.signedRightShift(tenthsOfAMicrosecond, _jsbi.default.BigInt(32)), _jsbi.default.BigInt(0xffffffff)));\n\n      var result = Buffer.alloc(8);\n      result.writeUInt32LE(lo, 0);\n      result.writeUInt32LE(hi, 4);\n      return result;\n    }\n  }, {\n    key: \"lmv2Response\",\n    value: function lmv2Response(domain, user, password, serverNonce, clientNonce) {\n      var hash = this.ntv2Hash(domain, user, password);\n      var data = Buffer.alloc(serverNonce.length + clientNonce.length, 0);\n      serverNonce.copy(data);\n      clientNonce.copy(data, serverNonce.length, 0, clientNonce.length);\n      var newhash = this.hmacMD5(data, hash);\n      var response = Buffer.alloc(newhash.length + clientNonce.length, 0);\n      newhash.copy(response);\n      clientNonce.copy(response, newhash.length, 0, clientNonce.length);\n      return response;\n    }\n  }, {\n    key: \"ntv2Hash\",\n    value: function ntv2Hash(domain, user, password) {\n      var hash = this.ntHash(password);\n      var identity = Buffer.from(user.toUpperCase() + domain.toUpperCase(), 'ucs2');\n      return this.hmacMD5(identity, hash);\n    }\n  }, {\n    key: \"ntHash\",\n    value: function ntHash(text) {\n      var unicodeString = Buffer.from(text, 'ucs2');\n      return crypto.createHash('md4').update(unicodeString).digest();\n    }\n  }, {\n    key: \"hmacMD5\",\n    value: function hmacMD5(data, key) {\n      return crypto.createHmac('MD5', key).update(data).digest();\n    }\n  }]);\n\n  return NTLMResponsePayload;\n}();\n\nvar _default = NTLMResponsePayload;\nexports.default = _default;\nmodule.exports = NTLMResponsePayload;","map":{"version":3,"sources":["C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/mssql/node_modules/tedious/lib/ntlm-payload.js"],"names":["Object","defineProperty","exports","value","default","_writableTrackingBuffer","_interopRequireDefault","require","crypto","_interopRequireWildcard","_jsbi","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","NTLMResponsePayload","loginData","data","createResponse","indent","challenge","client_nonce","createClientNonce","lmv2len","ntlmv2len","domain","username","userName","password","ntlmData","ntlmpacket","server_data","target","server_nonce","nonce","bufferLength","length","position","writeString","writeUInt32LE","baseIdx","dnIdx","unIdx","l2Idx","ntIdx","writeUInt16LE","lmv2Data","lmv2Response","copyFrom","genTime","Date","getTime","ntlmDataBuffer","ntlmv2Response","timestamp","createTimestamp","Buffer","alloc","nidx","writeUInt8","Math","ceil","random","user","serverNonce","targetInfo","clientNonce","mytime","hash","ntv2Hash","dataLength","copy","hmacMD5","time","tenthsOfAMicrosecond","multiply","add","BigInt","lo","toNumber","bitwiseAnd","hi","signedRightShift","result","newhash","response","ntHash","identity","from","toUpperCase","text","unicodeString","createHash","update","digest","createHmac","_default","module"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.default = void 0;\r\n\r\nvar _writableTrackingBuffer = _interopRequireDefault(require(\"./tracking-buffer/writable-tracking-buffer\"));\r\n\r\nvar crypto = _interopRequireWildcard(require(\"crypto\"));\r\n\r\nvar _jsbi = _interopRequireDefault(require(\"jsbi\"));\r\n\r\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\r\n\r\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nclass NTLMResponsePayload {\r\n  constructor(loginData) {\r\n    this.data = void 0;\r\n    this.data = this.createResponse(loginData);\r\n  }\r\n\r\n  toString(indent = '') {\r\n    return indent + 'NTLM Auth';\r\n  }\r\n\r\n  createResponse(challenge) {\r\n    const client_nonce = this.createClientNonce();\r\n    const lmv2len = 24;\r\n    const ntlmv2len = 16;\r\n    const domain = challenge.domain;\r\n    const username = challenge.userName;\r\n    const password = challenge.password;\r\n    const ntlmData = challenge.ntlmpacket;\r\n    const server_data = ntlmData.target;\r\n    const server_nonce = ntlmData.nonce;\r\n    const bufferLength = 64 + domain.length * 2 + username.length * 2 + lmv2len + ntlmv2len + 8 + 8 + 8 + 4 + server_data.length + 4;\r\n    const data = new _writableTrackingBuffer.default(bufferLength);\r\n    data.position = 0;\r\n    data.writeString('NTLMSSP\\u0000', 'utf8');\r\n    data.writeUInt32LE(0x03);\r\n    const baseIdx = 64;\r\n    const dnIdx = baseIdx;\r\n    const unIdx = dnIdx + domain.length * 2;\r\n    const l2Idx = unIdx + username.length * 2;\r\n    const ntIdx = l2Idx + lmv2len;\r\n    data.writeUInt16LE(lmv2len);\r\n    data.writeUInt16LE(lmv2len);\r\n    data.writeUInt32LE(l2Idx);\r\n    data.writeUInt16LE(ntlmv2len);\r\n    data.writeUInt16LE(ntlmv2len);\r\n    data.writeUInt32LE(ntIdx);\r\n    data.writeUInt16LE(domain.length * 2);\r\n    data.writeUInt16LE(domain.length * 2);\r\n    data.writeUInt32LE(dnIdx);\r\n    data.writeUInt16LE(username.length * 2);\r\n    data.writeUInt16LE(username.length * 2);\r\n    data.writeUInt32LE(unIdx);\r\n    data.writeUInt16LE(0);\r\n    data.writeUInt16LE(0);\r\n    data.writeUInt32LE(baseIdx);\r\n    data.writeUInt16LE(0);\r\n    data.writeUInt16LE(0);\r\n    data.writeUInt32LE(baseIdx);\r\n    data.writeUInt16LE(0x8201);\r\n    data.writeUInt16LE(0x08);\r\n    data.writeString(domain, 'ucs2');\r\n    data.writeString(username, 'ucs2');\r\n    const lmv2Data = this.lmv2Response(domain, username, password, server_nonce, client_nonce);\r\n    data.copyFrom(lmv2Data);\r\n    const genTime = new Date().getTime();\r\n    const ntlmDataBuffer = this.ntlmv2Response(domain, username, password, server_nonce, server_data, client_nonce, genTime);\r\n    data.copyFrom(ntlmDataBuffer);\r\n    data.writeUInt32LE(0x0101);\r\n    data.writeUInt32LE(0x0000);\r\n    const timestamp = this.createTimestamp(genTime);\r\n    data.copyFrom(timestamp);\r\n    data.copyFrom(client_nonce);\r\n    data.writeUInt32LE(0x0000);\r\n    data.copyFrom(server_data);\r\n    data.writeUInt32LE(0x0000);\r\n    return data.data;\r\n  }\r\n\r\n  createClientNonce() {\r\n    const client_nonce = Buffer.alloc(8, 0);\r\n    let nidx = 0;\r\n\r\n    while (nidx < 8) {\r\n      client_nonce.writeUInt8(Math.ceil(Math.random() * 255), nidx);\r\n      nidx++;\r\n    }\r\n\r\n    return client_nonce;\r\n  }\r\n\r\n  ntlmv2Response(domain, user, password, serverNonce, targetInfo, clientNonce, mytime) {\r\n    const timestamp = this.createTimestamp(mytime);\r\n    const hash = this.ntv2Hash(domain, user, password);\r\n    const dataLength = 40 + targetInfo.length;\r\n    const data = Buffer.alloc(dataLength, 0);\r\n    serverNonce.copy(data, 0, 0, 8);\r\n    data.writeUInt32LE(0x101, 8);\r\n    data.writeUInt32LE(0x0, 12);\r\n    timestamp.copy(data, 16, 0, 8);\r\n    clientNonce.copy(data, 24, 0, 8);\r\n    data.writeUInt32LE(0x0, 32);\r\n    targetInfo.copy(data, 36, 0, targetInfo.length);\r\n    data.writeUInt32LE(0x0, 36 + targetInfo.length);\r\n    return this.hmacMD5(data, hash);\r\n  }\r\n\r\n  createTimestamp(time) {\r\n    const tenthsOfAMicrosecond = _jsbi.default.multiply(_jsbi.default.add(_jsbi.default.BigInt(time), _jsbi.default.BigInt(11644473600)), _jsbi.default.BigInt(10000000));\r\n\r\n    const lo = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(tenthsOfAMicrosecond, _jsbi.default.BigInt(0xffffffff)));\r\n\r\n    const hi = _jsbi.default.toNumber(_jsbi.default.bitwiseAnd(_jsbi.default.signedRightShift(tenthsOfAMicrosecond, _jsbi.default.BigInt(32)), _jsbi.default.BigInt(0xffffffff)));\r\n\r\n    const result = Buffer.alloc(8);\r\n    result.writeUInt32LE(lo, 0);\r\n    result.writeUInt32LE(hi, 4);\r\n    return result;\r\n  }\r\n\r\n  lmv2Response(domain, user, password, serverNonce, clientNonce) {\r\n    const hash = this.ntv2Hash(domain, user, password);\r\n    const data = Buffer.alloc(serverNonce.length + clientNonce.length, 0);\r\n    serverNonce.copy(data);\r\n    clientNonce.copy(data, serverNonce.length, 0, clientNonce.length);\r\n    const newhash = this.hmacMD5(data, hash);\r\n    const response = Buffer.alloc(newhash.length + clientNonce.length, 0);\r\n    newhash.copy(response);\r\n    clientNonce.copy(response, newhash.length, 0, clientNonce.length);\r\n    return response;\r\n  }\r\n\r\n  ntv2Hash(domain, user, password) {\r\n    const hash = this.ntHash(password);\r\n    const identity = Buffer.from(user.toUpperCase() + domain.toUpperCase(), 'ucs2');\r\n    return this.hmacMD5(identity, hash);\r\n  }\r\n\r\n  ntHash(text) {\r\n    const unicodeString = Buffer.from(text, 'ucs2');\r\n    return crypto.createHash('md4').update(unicodeString).digest();\r\n  }\r\n\r\n  hmacMD5(data, key) {\r\n    return crypto.createHmac('MD5', key).update(data).digest();\r\n  }\r\n\r\n}\r\n\r\nvar _default = NTLMResponsePayload;\r\nexports.default = _default;\r\nmodule.exports = NTLMResponsePayload;"]},"metadata":{},"sourceType":"script"}