{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _get = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/get\");\n\nvar _getPrototypeOf = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _bl = _interopRequireDefault(require(\"bl\"));\n\nvar _stream = require(\"stream\");\n\nvar _message = _interopRequireDefault(require(\"./message\"));\n\nvar _packet = require(\"./packet\");\n\nvar _errors = require(\"./errors\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\r\n  IncomingMessageStream\r\n  Transform received TDS data into individual IncomingMessage streams.\r\n*/\n\n\nvar IncomingMessageStream = /*#__PURE__*/function (_stream$Transform) {\n  _inherits(IncomingMessageStream, _stream$Transform);\n\n  var _super = _createSuper(IncomingMessageStream);\n\n  function IncomingMessageStream(debug) {\n    var _this;\n\n    _classCallCheck(this, IncomingMessageStream);\n\n    _this = _super.call(this, {\n      readableObjectMode: true\n    });\n    _this.debug = void 0;\n    _this.bl = void 0;\n    _this.currentMessage = void 0;\n    _this.debug = debug;\n    _this.currentMessage = undefined;\n    _this.bl = new _bl.default();\n    return _this;\n  }\n\n  _createClass(IncomingMessageStream, [{\n    key: \"pause\",\n    value: function pause() {\n      _get(_getPrototypeOf(IncomingMessageStream.prototype), \"pause\", this).call(this);\n\n      if (this.currentMessage) {\n        this.currentMessage.pause();\n      }\n\n      return this;\n    }\n  }, {\n    key: \"resume\",\n    value: function resume() {\n      _get(_getPrototypeOf(IncomingMessageStream.prototype), \"resume\", this).call(this);\n\n      if (this.currentMessage) {\n        this.currentMessage.resume();\n      }\n\n      return this;\n    }\n  }, {\n    key: \"processBufferedData\",\n    value: function processBufferedData(callback) {\n      var _this2 = this;\n\n      // The packet header is always 8 bytes of length.\n      while (this.bl.length >= _packet.HEADER_LENGTH) {\n        // Get the full packet length\n        var length = this.bl.readUInt16BE(2);\n\n        if (length < _packet.HEADER_LENGTH) {\n          return callback(new _errors.ConnectionError('Unable to process incoming packet'));\n        }\n\n        if (this.bl.length >= length) {\n          var data = this.bl.slice(0, length);\n          this.bl.consume(length); // TODO: Get rid of creating `Packet` instances here.\n\n          var packet = new _packet.Packet(data);\n          this.debug.packet('Received', packet);\n          this.debug.data(packet);\n          var message = this.currentMessage;\n\n          if (message === undefined) {\n            this.currentMessage = message = new _message.default({\n              type: packet.type(),\n              resetConnection: false\n            });\n            this.push(message);\n          }\n\n          if (packet.isLast()) {\n            // Wait until the current message was fully processed before we\n            // continue processing any remaining messages.\n            message.once('end', function () {\n              _this2.currentMessage = undefined;\n\n              _this2.processBufferedData(callback);\n            });\n            message.end(packet.data());\n            return;\n          } else if (!message.write(packet.data())) {\n            // If too much data is buffering up in the\n            // current message, wait for it to drain.\n            message.once('drain', function () {\n              _this2.processBufferedData(callback);\n            });\n            return;\n          }\n        } else {\n          break;\n        }\n      } // Not enough data to read the next packet. Stop here and wait for\n      // the next call to `_transform`.\n\n\n      callback();\n    }\n  }, {\n    key: \"_transform\",\n    value: function _transform(chunk, _encoding, callback) {\n      this.bl.append(chunk);\n      this.processBufferedData(callback);\n    }\n  }]);\n\n  return IncomingMessageStream;\n}(_stream.Transform);\n\nvar _default = IncomingMessageStream;\nexports.default = _default;\nmodule.exports = IncomingMessageStream;","map":{"version":3,"sources":["C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/mssql/node_modules/tedious/lib/incoming-message-stream.js"],"names":["Object","defineProperty","exports","value","default","_bl","_interopRequireDefault","require","_stream","_message","_packet","_errors","obj","__esModule","IncomingMessageStream","debug","readableObjectMode","bl","currentMessage","undefined","pause","resume","callback","length","HEADER_LENGTH","readUInt16BE","ConnectionError","data","slice","consume","packet","Packet","message","type","resetConnection","push","isLast","once","processBufferedData","end","write","chunk","_encoding","append","Transform","_default","module"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.default = void 0;\r\n\r\nvar _bl = _interopRequireDefault(require(\"bl\"));\r\n\r\nvar _stream = require(\"stream\");\r\n\r\nvar _message = _interopRequireDefault(require(\"./message\"));\r\n\r\nvar _packet = require(\"./packet\");\r\n\r\nvar _errors = require(\"./errors\");\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\n/**\r\n  IncomingMessageStream\r\n  Transform received TDS data into individual IncomingMessage streams.\r\n*/\r\nclass IncomingMessageStream extends _stream.Transform {\r\n  constructor(debug) {\r\n    super({\r\n      readableObjectMode: true\r\n    });\r\n    this.debug = void 0;\r\n    this.bl = void 0;\r\n    this.currentMessage = void 0;\r\n    this.debug = debug;\r\n    this.currentMessage = undefined;\r\n    this.bl = new _bl.default();\r\n  }\r\n\r\n  pause() {\r\n    super.pause();\r\n\r\n    if (this.currentMessage) {\r\n      this.currentMessage.pause();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  resume() {\r\n    super.resume();\r\n\r\n    if (this.currentMessage) {\r\n      this.currentMessage.resume();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  processBufferedData(callback) {\r\n    // The packet header is always 8 bytes of length.\r\n    while (this.bl.length >= _packet.HEADER_LENGTH) {\r\n      // Get the full packet length\r\n      const length = this.bl.readUInt16BE(2);\r\n\r\n      if (length < _packet.HEADER_LENGTH) {\r\n        return callback(new _errors.ConnectionError('Unable to process incoming packet'));\r\n      }\r\n\r\n      if (this.bl.length >= length) {\r\n        const data = this.bl.slice(0, length);\r\n        this.bl.consume(length); // TODO: Get rid of creating `Packet` instances here.\r\n\r\n        const packet = new _packet.Packet(data);\r\n        this.debug.packet('Received', packet);\r\n        this.debug.data(packet);\r\n        let message = this.currentMessage;\r\n\r\n        if (message === undefined) {\r\n          this.currentMessage = message = new _message.default({\r\n            type: packet.type(),\r\n            resetConnection: false\r\n          });\r\n          this.push(message);\r\n        }\r\n\r\n        if (packet.isLast()) {\r\n          // Wait until the current message was fully processed before we\r\n          // continue processing any remaining messages.\r\n          message.once('end', () => {\r\n            this.currentMessage = undefined;\r\n            this.processBufferedData(callback);\r\n          });\r\n          message.end(packet.data());\r\n          return;\r\n        } else if (!message.write(packet.data())) {\r\n          // If too much data is buffering up in the\r\n          // current message, wait for it to drain.\r\n          message.once('drain', () => {\r\n            this.processBufferedData(callback);\r\n          });\r\n          return;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    } // Not enough data to read the next packet. Stop here and wait for\r\n    // the next call to `_transform`.\r\n\r\n\r\n    callback();\r\n  }\r\n\r\n  _transform(chunk, _encoding, callback) {\r\n    this.bl.append(chunk);\r\n    this.processBufferedData(callback);\r\n  }\r\n\r\n}\r\n\r\nvar _default = IncomingMessageStream;\r\nexports.default = _default;\r\nmodule.exports = IncomingMessageStream;"]},"metadata":{},"sourceType":"script"}