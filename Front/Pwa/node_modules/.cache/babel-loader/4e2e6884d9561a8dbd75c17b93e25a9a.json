{"ast":null,"code":"\"use strict\"; // Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\n\nvar _regeneratorRuntime = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _createForOfIteratorHelper = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar msRest = require(\"@azure/ms-rest-js\");\n\nvar applicationTokenCredentialsBase_1 = require(\"../credentials/applicationTokenCredentialsBase\");\n\nvar authConstants_1 = require(\"../util/authConstants\");\n/**\r\n * Builds an array of tenantIds.\r\n * @param credentials - The credentials.\r\n * @param apiVersion - default value 2016-06-01\r\n * @returns A promise that resolves to an array of tenantIds and rejects with an error.\r\n */\n\n\nfunction buildTenantList(credentials) {\n  var apiVersion = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"2016-06-01\";\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var client, baseUrl, reqUrl, req, res, result, tenants, _iterator, _step, tenant;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(credentials.domain && credentials.domain !== authConstants_1.AuthConstants.AAD_COMMON_TENANT)) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\", [credentials.domain]);\n\n          case 2:\n            client = new msRest.ServiceClient(credentials);\n            baseUrl = credentials.environment.resourceManagerEndpointUrl;\n            reqUrl = \"\".concat(baseUrl).concat(baseUrl.endsWith(\"/\") ? \"\" : \"/\", \"tenants?api-version=\").concat(apiVersion);\n            req = {\n              url: reqUrl,\n              method: \"GET\"\n            };\n            _context.next = 8;\n            return client.sendRequest(req);\n\n          case 8:\n            res = _context.sent;\n            result = [];\n\n            if (res.status < 300) {\n              tenants = res.parsedBody;\n              _iterator = _createForOfIteratorHelper(tenants.value);\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  tenant = _step.value;\n                  result.push(tenant.tenantId);\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n            }\n\n            return _context.abrupt(\"return\", result);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n}\n\nexports.buildTenantList = buildTenantList;\n\nfunction getSubscriptionsFromTenants(credentials, tenantList) {\n  var apiVersion = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"2016-06-01\";\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var subscriptions, userType, username, originalDomain, _iterator2, _step2, _loop;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            subscriptions = [];\n            userType = \"user\";\n            originalDomain = credentials.domain;\n\n            if (credentials instanceof applicationTokenCredentialsBase_1.ApplicationTokenCredentialsBase) {\n              userType = \"servicePrincipal\";\n              username = credentials.clientId;\n            } else {\n              username = credentials.username;\n            }\n\n            _iterator2 = _createForOfIteratorHelper(tenantList);\n            _context3.prev = 5;\n            _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n              var tenant, client, baseUrl, reqUrl, req, res, subscriptionList;\n              return _regeneratorRuntime.wrap(function _loop$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      tenant = _step2.value;\n                      credentials.domain = tenant;\n                      client = new msRest.ServiceClient(credentials);\n                      baseUrl = credentials.environment.resourceManagerEndpointUrl;\n                      reqUrl = \"\".concat(baseUrl).concat(baseUrl.endsWith(\"/\") ? \"\" : \"/\", \"subscriptions?api-version=\").concat(apiVersion);\n                      req = {\n                        url: reqUrl,\n                        method: \"GET\"\n                      };\n                      _context2.next = 8;\n                      return client.sendRequest(req);\n\n                    case 8:\n                      res = _context2.sent;\n                      subscriptionList = res.parsedBody.value;\n                      subscriptions = subscriptions.concat(subscriptionList.map(function (s) {\n                        s.tenantId = tenant;\n                        s.user = {\n                          name: username,\n                          type: userType\n                        };\n                        s.environmentName = credentials.environment.name;\n                        s.name = s.displayName;\n                        s.id = s.subscriptionId;\n                        delete s.displayName;\n                        delete s.subscriptionId;\n                        delete s.subscriptionPolicies;\n                        return s;\n                      }));\n\n                    case 11:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }, _loop);\n            });\n\n            _iterator2.s();\n\n          case 8:\n            if ((_step2 = _iterator2.n()).done) {\n              _context3.next = 12;\n              break;\n            }\n\n            return _context3.delegateYield(_loop(), \"t0\", 10);\n\n          case 10:\n            _context3.next = 8;\n            break;\n\n          case 12:\n            _context3.next = 17;\n            break;\n\n          case 14:\n            _context3.prev = 14;\n            _context3.t1 = _context3[\"catch\"](5);\n\n            _iterator2.e(_context3.t1);\n\n          case 17:\n            _context3.prev = 17;\n\n            _iterator2.f();\n\n            return _context3.finish(17);\n\n          case 20:\n            // Reset the original domain.\n            credentials.domain = originalDomain;\n            return _context3.abrupt(\"return\", subscriptions);\n\n          case 22:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee2, null, [[5, 14, 17, 20]]);\n  }));\n}\n\nexports.getSubscriptionsFromTenants = getSubscriptionsFromTenants;","map":{"version":3,"sources":["../../../lib/subscriptionManagement/subscriptionUtils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst msRest = require(\"@azure/ms-rest-js\");\r\nconst applicationTokenCredentialsBase_1 = require(\"../credentials/applicationTokenCredentialsBase\");\r\nconst authConstants_1 = require(\"../util/authConstants\");\r\n/**\r\n * Builds an array of tenantIds.\r\n * @param credentials - The credentials.\r\n * @param apiVersion - default value 2016-06-01\r\n * @returns A promise that resolves to an array of tenantIds and rejects with an error.\r\n */\r\nfunction buildTenantList(credentials, apiVersion = \"2016-06-01\") {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (credentials.domain && credentials.domain !== authConstants_1.AuthConstants.AAD_COMMON_TENANT) {\r\n            return [credentials.domain];\r\n        }\r\n        const client = new msRest.ServiceClient(credentials);\r\n        const baseUrl = credentials.environment.resourceManagerEndpointUrl;\r\n        const reqUrl = `${baseUrl}${baseUrl.endsWith(\"/\") ? \"\" : \"/\"}tenants?api-version=${apiVersion}`;\r\n        const req = {\r\n            url: reqUrl,\r\n            method: \"GET\"\r\n        };\r\n        const res = yield client.sendRequest(req);\r\n        const result = [];\r\n        if (res.status < 300) {\r\n            const tenants = res.parsedBody;\r\n            for (const tenant of tenants.value) {\r\n                result.push(tenant.tenantId);\r\n            }\r\n        }\r\n        return result;\r\n    });\r\n}\r\nexports.buildTenantList = buildTenantList;\r\nfunction getSubscriptionsFromTenants(credentials, tenantList, apiVersion = \"2016-06-01\") {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let subscriptions = [];\r\n        let userType = \"user\";\r\n        let username;\r\n        const originalDomain = credentials.domain;\r\n        if (credentials instanceof applicationTokenCredentialsBase_1.ApplicationTokenCredentialsBase) {\r\n            userType = \"servicePrincipal\";\r\n            username = credentials.clientId;\r\n        }\r\n        else {\r\n            username = credentials.username;\r\n        }\r\n        for (const tenant of tenantList) {\r\n            credentials.domain = tenant;\r\n            const client = new msRest.ServiceClient(credentials);\r\n            const baseUrl = credentials.environment.resourceManagerEndpointUrl;\r\n            const reqUrl = `${baseUrl}${baseUrl.endsWith(\"/\") ? \"\" : \"/\"}subscriptions?api-version=${apiVersion}`;\r\n            const req = {\r\n                url: reqUrl,\r\n                method: \"GET\"\r\n            };\r\n            const res = yield client.sendRequest(req);\r\n            const subscriptionList = res.parsedBody.value;\r\n            subscriptions = subscriptions.concat(subscriptionList.map((s) => {\r\n                s.tenantId = tenant;\r\n                s.user = { name: username, type: userType };\r\n                s.environmentName = credentials.environment.name;\r\n                s.name = s.displayName;\r\n                s.id = s.subscriptionId;\r\n                delete s.displayName;\r\n                delete s.subscriptionId;\r\n                delete s.subscriptionPolicies;\r\n                return s;\r\n            }));\r\n        }\r\n        // Reset the original domain.\r\n        credentials.domain = originalDomain;\r\n        return subscriptions;\r\n    });\r\n}\r\nexports.getSubscriptionsFromTenants = getSubscriptionsFromTenants;\r\n//# sourceMappingURL=subscriptionUtils.js.map"]},"metadata":{},"sourceType":"script"}