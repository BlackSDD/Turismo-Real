{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _sprintfJs = require(\"sprintf-js\");\n\nvar _writableTrackingBuffer = _interopRequireDefault(require(\"./tracking-buffer/writable-tracking-buffer\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar optionBufferSize = 20;\nvar TOKEN = {\n  VERSION: 0x00,\n  ENCRYPTION: 0x01,\n  INSTOPT: 0x02,\n  THREADID: 0x03,\n  MARS: 0x04,\n  FEDAUTHREQUIRED: 0x06,\n  TERMINATOR: 0xFF\n};\nvar ENCRYPT = {\n  OFF: 0x00,\n  ON: 0x01,\n  NOT_SUP: 0x02,\n  REQ: 0x03\n};\nvar encryptByValue = {};\n\nfor (var name in ENCRYPT) {\n  var value = ENCRYPT[name];\n  encryptByValue[value] = name;\n}\n\nvar MARS = {\n  OFF: 0x00,\n  ON: 0x01\n};\nvar marsByValue = {};\n\nfor (var _name in MARS) {\n  var _value = MARS[_name];\n  marsByValue[_value] = _name;\n}\n/*\r\n  s2.2.6.4\r\n */\n\n\nvar PreloginPayload = /*#__PURE__*/function () {\n  function PreloginPayload() {\n    var bufferOrOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      encrypt: false,\n      version: {\n        major: 0,\n        minor: 0,\n        build: 0,\n        subbuild: 0\n      }\n    };\n\n    _classCallCheck(this, PreloginPayload);\n\n    this.data = void 0;\n    this.options = void 0;\n    this.version = void 0;\n    this.encryption = void 0;\n    this.encryptionString = void 0;\n    this.instance = void 0;\n    this.threadId = void 0;\n    this.mars = void 0;\n    this.marsString = void 0;\n    this.fedAuthRequired = void 0;\n\n    if (bufferOrOptions instanceof Buffer) {\n      this.data = bufferOrOptions;\n      this.options = {\n        encrypt: false,\n        version: {\n          major: 0,\n          minor: 0,\n          build: 0,\n          subbuild: 0\n        }\n      };\n    } else {\n      this.options = bufferOrOptions;\n      this.createOptions();\n    }\n\n    this.extractOptions();\n  }\n\n  _createClass(PreloginPayload, [{\n    key: \"createOptions\",\n    value: function createOptions() {\n      var options = [this.createVersionOption(), this.createEncryptionOption(), this.createInstanceOption(), this.createThreadIdOption(), this.createMarsOption(), this.createFedAuthOption()];\n      var length = 0;\n\n      for (var i = 0, len = options.length; i < len; i++) {\n        var option = options[i];\n        length += 5 + option.data.length;\n      }\n\n      length++; // terminator\n\n      this.data = Buffer.alloc(length, 0);\n      var optionOffset = 0;\n      var optionDataOffset = 5 * options.length + 1;\n\n      for (var j = 0, _len = options.length; j < _len; j++) {\n        var _option = options[j];\n        this.data.writeUInt8(_option.token, optionOffset + 0);\n        this.data.writeUInt16BE(optionDataOffset, optionOffset + 1);\n        this.data.writeUInt16BE(_option.data.length, optionOffset + 3);\n        optionOffset += 5;\n\n        _option.data.copy(this.data, optionDataOffset);\n\n        optionDataOffset += _option.data.length;\n      }\n\n      this.data.writeUInt8(TOKEN.TERMINATOR, optionOffset);\n    }\n  }, {\n    key: \"createVersionOption\",\n    value: function createVersionOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n      buffer.writeUInt8(this.options.version.major);\n      buffer.writeUInt8(this.options.version.minor);\n      buffer.writeUInt16BE(this.options.version.build);\n      buffer.writeUInt16BE(this.options.version.subbuild);\n      return {\n        token: TOKEN.VERSION,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"createEncryptionOption\",\n    value: function createEncryptionOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n\n      if (this.options.encrypt) {\n        buffer.writeUInt8(ENCRYPT.ON);\n      } else {\n        buffer.writeUInt8(ENCRYPT.NOT_SUP);\n      }\n\n      return {\n        token: TOKEN.ENCRYPTION,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"createInstanceOption\",\n    value: function createInstanceOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n      buffer.writeUInt8(0x00);\n      return {\n        token: TOKEN.INSTOPT,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"createThreadIdOption\",\n    value: function createThreadIdOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n      buffer.writeUInt32BE(0x00);\n      return {\n        token: TOKEN.THREADID,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"createMarsOption\",\n    value: function createMarsOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n      buffer.writeUInt8(MARS.OFF);\n      return {\n        token: TOKEN.MARS,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"createFedAuthOption\",\n    value: function createFedAuthOption() {\n      var buffer = new _writableTrackingBuffer.default(optionBufferSize);\n      buffer.writeUInt8(0x01);\n      return {\n        token: TOKEN.FEDAUTHREQUIRED,\n        data: buffer.data\n      };\n    }\n  }, {\n    key: \"extractOptions\",\n    value: function extractOptions() {\n      var offset = 0;\n\n      while (this.data[offset] !== TOKEN.TERMINATOR) {\n        var dataOffset = this.data.readUInt16BE(offset + 1);\n        var dataLength = this.data.readUInt16BE(offset + 3);\n\n        switch (this.data[offset]) {\n          case TOKEN.VERSION:\n            this.extractVersion(dataOffset);\n            break;\n\n          case TOKEN.ENCRYPTION:\n            this.extractEncryption(dataOffset);\n            break;\n\n          case TOKEN.INSTOPT:\n            this.extractInstance(dataOffset);\n            break;\n\n          case TOKEN.THREADID:\n            if (dataLength > 0) {\n              this.extractThreadId(dataOffset);\n            }\n\n            break;\n\n          case TOKEN.MARS:\n            this.extractMars(dataOffset);\n            break;\n\n          case TOKEN.FEDAUTHREQUIRED:\n            this.extractFedAuth(dataOffset);\n            break;\n        }\n\n        offset += 5;\n        dataOffset += dataLength;\n      }\n    }\n  }, {\n    key: \"extractVersion\",\n    value: function extractVersion(offset) {\n      this.version = {\n        major: this.data.readUInt8(offset + 0),\n        minor: this.data.readUInt8(offset + 1),\n        build: this.data.readUInt16BE(offset + 2),\n        subbuild: this.data.readUInt16BE(offset + 4)\n      };\n    }\n  }, {\n    key: \"extractEncryption\",\n    value: function extractEncryption(offset) {\n      this.encryption = this.data.readUInt8(offset);\n      this.encryptionString = encryptByValue[this.encryption];\n    }\n  }, {\n    key: \"extractInstance\",\n    value: function extractInstance(offset) {\n      this.instance = this.data.readUInt8(offset);\n    }\n  }, {\n    key: \"extractThreadId\",\n    value: function extractThreadId(offset) {\n      this.threadId = this.data.readUInt32BE(offset);\n    }\n  }, {\n    key: \"extractMars\",\n    value: function extractMars(offset) {\n      this.mars = this.data.readUInt8(offset);\n      this.marsString = marsByValue[this.mars];\n    }\n  }, {\n    key: \"extractFedAuth\",\n    value: function extractFedAuth(offset) {\n      this.fedAuthRequired = this.data.readUInt8(offset);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var indent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      return indent + 'PreLogin - ' + (0, _sprintfJs.sprintf)('version:%d.%d.%d.%d, encryption:0x%02X(%s), instopt:0x%02X, threadId:0x%08X, mars:0x%02X(%s)', this.version.major, this.version.minor, this.version.build, this.version.subbuild, this.encryption ? this.encryption : 0, this.encryptionString ? this.encryptionString : '', this.instance ? this.instance : 0, this.threadId ? this.threadId : 0, this.mars ? this.mars : 0, this.marsString ? this.marsString : '');\n    }\n  }]);\n\n  return PreloginPayload;\n}();\n\nvar _default = PreloginPayload;\nexports.default = _default;\nmodule.exports = PreloginPayload;","map":{"version":3,"sources":["C:/Users/jesus/Documents/GitHub/Turismo-Real/Front/Pwa/node_modules/mssql/node_modules/tedious/lib/prelogin-payload.js"],"names":["Object","defineProperty","exports","value","default","_sprintfJs","require","_writableTrackingBuffer","_interopRequireDefault","obj","__esModule","optionBufferSize","TOKEN","VERSION","ENCRYPTION","INSTOPT","THREADID","MARS","FEDAUTHREQUIRED","TERMINATOR","ENCRYPT","OFF","ON","NOT_SUP","REQ","encryptByValue","name","marsByValue","PreloginPayload","bufferOrOptions","encrypt","version","major","minor","build","subbuild","data","options","encryption","encryptionString","instance","threadId","mars","marsString","fedAuthRequired","Buffer","createOptions","extractOptions","createVersionOption","createEncryptionOption","createInstanceOption","createThreadIdOption","createMarsOption","createFedAuthOption","length","i","len","option","alloc","optionOffset","optionDataOffset","j","writeUInt8","token","writeUInt16BE","copy","buffer","writeUInt32BE","offset","dataOffset","readUInt16BE","dataLength","extractVersion","extractEncryption","extractInstance","extractThreadId","extractMars","extractFedAuth","readUInt8","readUInt32BE","indent","sprintf","_default","module"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.default = void 0;\r\n\r\nvar _sprintfJs = require(\"sprintf-js\");\r\n\r\nvar _writableTrackingBuffer = _interopRequireDefault(require(\"./tracking-buffer/writable-tracking-buffer\"));\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nconst optionBufferSize = 20;\r\nconst TOKEN = {\r\n  VERSION: 0x00,\r\n  ENCRYPTION: 0x01,\r\n  INSTOPT: 0x02,\r\n  THREADID: 0x03,\r\n  MARS: 0x04,\r\n  FEDAUTHREQUIRED: 0x06,\r\n  TERMINATOR: 0xFF\r\n};\r\nconst ENCRYPT = {\r\n  OFF: 0x00,\r\n  ON: 0x01,\r\n  NOT_SUP: 0x02,\r\n  REQ: 0x03\r\n};\r\nconst encryptByValue = {};\r\n\r\nfor (const name in ENCRYPT) {\r\n  const value = ENCRYPT[name];\r\n  encryptByValue[value] = name;\r\n}\r\n\r\nconst MARS = {\r\n  OFF: 0x00,\r\n  ON: 0x01\r\n};\r\nconst marsByValue = {};\r\n\r\nfor (const name in MARS) {\r\n  const value = MARS[name];\r\n  marsByValue[value] = name;\r\n}\r\n\r\n/*\r\n  s2.2.6.4\r\n */\r\nclass PreloginPayload {\r\n  constructor(bufferOrOptions = {\r\n    encrypt: false,\r\n    version: {\r\n      major: 0,\r\n      minor: 0,\r\n      build: 0,\r\n      subbuild: 0\r\n    }\r\n  }) {\r\n    this.data = void 0;\r\n    this.options = void 0;\r\n    this.version = void 0;\r\n    this.encryption = void 0;\r\n    this.encryptionString = void 0;\r\n    this.instance = void 0;\r\n    this.threadId = void 0;\r\n    this.mars = void 0;\r\n    this.marsString = void 0;\r\n    this.fedAuthRequired = void 0;\r\n\r\n    if (bufferOrOptions instanceof Buffer) {\r\n      this.data = bufferOrOptions;\r\n      this.options = {\r\n        encrypt: false,\r\n        version: {\r\n          major: 0,\r\n          minor: 0,\r\n          build: 0,\r\n          subbuild: 0\r\n        }\r\n      };\r\n    } else {\r\n      this.options = bufferOrOptions;\r\n      this.createOptions();\r\n    }\r\n\r\n    this.extractOptions();\r\n  }\r\n\r\n  createOptions() {\r\n    const options = [this.createVersionOption(), this.createEncryptionOption(), this.createInstanceOption(), this.createThreadIdOption(), this.createMarsOption(), this.createFedAuthOption()];\r\n    let length = 0;\r\n\r\n    for (let i = 0, len = options.length; i < len; i++) {\r\n      const option = options[i];\r\n      length += 5 + option.data.length;\r\n    }\r\n\r\n    length++; // terminator\r\n\r\n    this.data = Buffer.alloc(length, 0);\r\n    let optionOffset = 0;\r\n    let optionDataOffset = 5 * options.length + 1;\r\n\r\n    for (let j = 0, len = options.length; j < len; j++) {\r\n      const option = options[j];\r\n      this.data.writeUInt8(option.token, optionOffset + 0);\r\n      this.data.writeUInt16BE(optionDataOffset, optionOffset + 1);\r\n      this.data.writeUInt16BE(option.data.length, optionOffset + 3);\r\n      optionOffset += 5;\r\n      option.data.copy(this.data, optionDataOffset);\r\n      optionDataOffset += option.data.length;\r\n    }\r\n\r\n    this.data.writeUInt8(TOKEN.TERMINATOR, optionOffset);\r\n  }\r\n\r\n  createVersionOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n    buffer.writeUInt8(this.options.version.major);\r\n    buffer.writeUInt8(this.options.version.minor);\r\n    buffer.writeUInt16BE(this.options.version.build);\r\n    buffer.writeUInt16BE(this.options.version.subbuild);\r\n    return {\r\n      token: TOKEN.VERSION,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  createEncryptionOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n\r\n    if (this.options.encrypt) {\r\n      buffer.writeUInt8(ENCRYPT.ON);\r\n    } else {\r\n      buffer.writeUInt8(ENCRYPT.NOT_SUP);\r\n    }\r\n\r\n    return {\r\n      token: TOKEN.ENCRYPTION,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  createInstanceOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n    buffer.writeUInt8(0x00);\r\n    return {\r\n      token: TOKEN.INSTOPT,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  createThreadIdOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n    buffer.writeUInt32BE(0x00);\r\n    return {\r\n      token: TOKEN.THREADID,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  createMarsOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n    buffer.writeUInt8(MARS.OFF);\r\n    return {\r\n      token: TOKEN.MARS,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  createFedAuthOption() {\r\n    const buffer = new _writableTrackingBuffer.default(optionBufferSize);\r\n    buffer.writeUInt8(0x01);\r\n    return {\r\n      token: TOKEN.FEDAUTHREQUIRED,\r\n      data: buffer.data\r\n    };\r\n  }\r\n\r\n  extractOptions() {\r\n    let offset = 0;\r\n\r\n    while (this.data[offset] !== TOKEN.TERMINATOR) {\r\n      let dataOffset = this.data.readUInt16BE(offset + 1);\r\n      const dataLength = this.data.readUInt16BE(offset + 3);\r\n\r\n      switch (this.data[offset]) {\r\n        case TOKEN.VERSION:\r\n          this.extractVersion(dataOffset);\r\n          break;\r\n\r\n        case TOKEN.ENCRYPTION:\r\n          this.extractEncryption(dataOffset);\r\n          break;\r\n\r\n        case TOKEN.INSTOPT:\r\n          this.extractInstance(dataOffset);\r\n          break;\r\n\r\n        case TOKEN.THREADID:\r\n          if (dataLength > 0) {\r\n            this.extractThreadId(dataOffset);\r\n          }\r\n\r\n          break;\r\n\r\n        case TOKEN.MARS:\r\n          this.extractMars(dataOffset);\r\n          break;\r\n\r\n        case TOKEN.FEDAUTHREQUIRED:\r\n          this.extractFedAuth(dataOffset);\r\n          break;\r\n      }\r\n\r\n      offset += 5;\r\n      dataOffset += dataLength;\r\n    }\r\n  }\r\n\r\n  extractVersion(offset) {\r\n    this.version = {\r\n      major: this.data.readUInt8(offset + 0),\r\n      minor: this.data.readUInt8(offset + 1),\r\n      build: this.data.readUInt16BE(offset + 2),\r\n      subbuild: this.data.readUInt16BE(offset + 4)\r\n    };\r\n  }\r\n\r\n  extractEncryption(offset) {\r\n    this.encryption = this.data.readUInt8(offset);\r\n    this.encryptionString = encryptByValue[this.encryption];\r\n  }\r\n\r\n  extractInstance(offset) {\r\n    this.instance = this.data.readUInt8(offset);\r\n  }\r\n\r\n  extractThreadId(offset) {\r\n    this.threadId = this.data.readUInt32BE(offset);\r\n  }\r\n\r\n  extractMars(offset) {\r\n    this.mars = this.data.readUInt8(offset);\r\n    this.marsString = marsByValue[this.mars];\r\n  }\r\n\r\n  extractFedAuth(offset) {\r\n    this.fedAuthRequired = this.data.readUInt8(offset);\r\n  }\r\n\r\n  toString(indent = '') {\r\n    return indent + 'PreLogin - ' + (0, _sprintfJs.sprintf)('version:%d.%d.%d.%d, encryption:0x%02X(%s), instopt:0x%02X, threadId:0x%08X, mars:0x%02X(%s)', this.version.major, this.version.minor, this.version.build, this.version.subbuild, this.encryption ? this.encryption : 0, this.encryptionString ? this.encryptionString : '', this.instance ? this.instance : 0, this.threadId ? this.threadId : 0, this.mars ? this.mars : 0, this.marsString ? this.marsString : '');\r\n  }\r\n\r\n}\r\n\r\nvar _default = PreloginPayload;\r\nexports.default = _default;\r\nmodule.exports = PreloginPayload;"]},"metadata":{},"sourceType":"script"}